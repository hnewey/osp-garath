<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Osp-Garath</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/rpg-awesome.css">
    <link rel="stylesheet" type="text/css" href="tooltipster/dist/css/tooltipster.bundle.min.css" />
    <link rel="stylesheet" href="tooltipster/dist/css/plugins/tooltipster/sideTip/themes/tooltipster-sideTip-borderless.min.css"/>

    <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
    <script type="text/javascript" src="tooltipster/dist/js/tooltipster.bundle.min.js"></script>
    <script type="text/javascript" src="js/tooltipster-discovery.min.js"></script>
</head>
<style>
    #body {
        color: yellow;
    }

    .tooltip_templates { display: none; }

    /*----------------------------------------------------------*/
    /* Modal Styling */
    /*----------------------------------------------------------*/

    .modal {
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Header */
    .modal-header {
        padding: 2px 16px;
        background-color: rgba(0,0,0,0.7);
        color: yellow;
        font-family: 'Marcellus SC', serif;
    }

    /* Modal Body */
    .modal-body {
        padding: 2px 16px;
    }

    /* Modal Footer */
    .modal-footer {
        padding: 2px 16px;
        background-color: rgba(0,0,0,0);
        color: yellow;
        text-align: center;
    }

    /* Modal Content */
    .modal-content {
        position: relative;
        margin: 9vh auto;
        padding: 0;
        border: 1px solid #888;
        width: 50%;
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
        animation-name: animatetop;
        animation-duration: 0.4s;
        background: url(img/background2.jpg) no-repeat;
        background-size: cover;
    }

    /* Add Animation */
    @keyframes animatetop {
        from {top: -300px; opacity: 0}
        to {top: 0; opacity: 1}
    }

    /* The Close Button */
    .close {
        color: yellow;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: #f2e540;
        text-decoration: none;
        cursor: pointer;
    }

    .modal_button {
        width: 6vw;
        height: 5vh;
        font-size: 10pt;
        margin: 1vw;
    }

    .modal_button:hover {
        box-shadow: 0 0 12px yellow;
    }

    #accept_modal_button {
        width: 6vw;
        height: 5vh;
        font-size: 10pt;
        margin: 1vw;
    }

    #cancel_modal_button {
        width: 6vw;
        height: 5vh;
        font-size: 10pt;
        margin: 1vw;
    }

    /*----------------------------------------------------------*/
    /* End Modal Styling */
    /*----------------------------------------------------------*/

    /*-------------------------------------------------------------------*/

    .ability_button {
        margin: 2vh 1vw 0 10.5vw;
    }

    #ability_scores {
        position: absolute;
        margin-left: 2vw;
        margin-top: 2vh;
        opacity: .9;
    }

    .ability_row {
        height: 14vh;
    }

    .ability_select {
        background: url(img/dropdown.jpg) no-repeat;
        display: inline-block;
        position: fixed;
        left: 68vw;
        margin-top: 3vh;
    }

    .center_cell {
        text-align: center;
    }

    .char_input {
        background: none;
        border-top: none;
        border-left: none;
        border-right: none;
        border-bottom: solid black;
        margin-bottom: 4vh;
        outline: none;
        text-blink: yellow;
        width: 20vw;
        font-size: 16pt;
        color: yellow;
        text-shadow: 1pt 1pt 5pt black;
    }

    .char_input:focus {
        border-bottom: solid yellow;
    }

    #class_body {
        position: absolute;
        left: 16vw;
        text-align: center;
        width: 50vw;
    }

    .currentScore {
        color: #de0606;
    }

    .disabled_button {
        opacity: .6;
    }

    .disabled_button:hover {
        box-shadow: none !important;
    }

    .disabled_menu_item {
        opacity: .6;
    }

    .disabled_menu_item:hover {
        border: none !important;
    }

    .error_message {
        text-shadow: 3px 2px 7px black;
        padding-left: 5px;
    }

    .game_button {
        background: url(img/button1.jpg) no-repeat;
        /*margin: 0 35%;*/
        background-size: 100% 100%;
        border: none;
        box-shadow: 0 0 0 1px darkslategrey;
        transition: all 100ms ease-out;
        font-size: 12pt;
        color: yellow;
        font-family: 'Marcellus SC', serif;
        text-shadow: 2px 2px 5px black;
        width: 10vw;
        height: 8vh;
        outline: none;
    }

    .game_button:hover {
        box-shadow: 0 0 12px yellow;
    }

    .low_end_rolls {
        text-decoration: line-through;
        opacity: .6;
    }

    .last_end_plus {
        opacity: .6;
    }

    #menu {
        display: flex;
        margin: 0 auto;
        padding: 10px 20px;
        background: rgba(0, 0, 0, .5);
        font-family: 'Marcellus SC', serif;
        font-size: 30px;
    }

    .menu_tab {
        background: none;
        border: none;
        color: yellow;
        margin-top: 6vh;
        margin-left: 6vh;
        transition: all 150ms ease-in-out;
        font-size: 10pt;
        font-family: 'Marcellus SC', serif;
        outline: none;
    }

    .menu_tab:hover {
        border-bottom: solid yellow;
    }

    .menu_tab_selected {
        border-bottom: solid yellow;
    }

    #middlePanel {
        width: 80vw;
        height: 100%;
        background: url(img/background7.png) no-repeat;
        -webkit-background-size: 100% 100%;
        background-size: 100% 100%;
        position: fixed;
        left: 10vw;
        /*border-style: none ridge none groove;*/
        border-color: antiquewhite;
        border-width: 5px;
    }

    .newScore {
        color: #3bbb53;
    }

    .power_div {
        display: inline-flex;
    }

    .power_div:hover {
        box-shadow: 0 0 12px yellow;
    }

    .power_selected {
        border-bottom: solid yellow;
    }

    .power_name {
        height: min-content;
        margin: auto;
        padding-left: 1vw;
    }

    #race_body {
        position: absolute;
        left: 16vw;
        text-align: center;
        width: 50vw;
    }

    .race_table {
        width: 100%;
        margin: 2vh auto;
        color: black;
        text-shadow: 0 0 0;
    }

    .race_table_header {
        border-bottom: 1pt solid black;
        width:50%;
    }

    .race_cell {
        padding: 2vw;

    }

    .race_left_cell {
    }

    .racial_modifier {

    }

    .roll_display {
        background: url(img/box.jpg) no-repeat;
        background-size: 100% 100%;
        border: none;
        box-shadow: 0 0 0 1px darkslategray;
        position: fixed;
        width: 35vw;
        height: 11vh;
    }

    .roll_numbers {
        position: relative;
        left: 2vw;
        top: 3.2vh;
    }

    .roll_span {
        font-size: 22pt;
        margin-left: 1vw;
    }

    .roll_total {
        display: inline-block;
        position: relative;
        left: 27.5vw;
        top: .5vh;
        font-size: 22pt;
    }

    #save {
        position: fixed;
        width: fit-content;
        bottom: 1vh;
        left: 44vw;
    }

    select {
        background: url(img/dropdown.jpg);
        background-size: 100% 100%;
        width: 14vw;
        height: 6vh;
        font-family: 'Marcellus SC', serif;
        font-size: 12pt;
        color: yellow;
        -webkit-appearance: none;
        padding-left: 1vw;
        outline:none;
        box-shadow: 0 0 0 2px black;
        text-shadow: 2px 2px 5px black;
    }

    select:hover {
        box-shadow: 0 0 12px yellow;
    }

    #select_class_first {
        position: absolute;
        left: 25vw;
        top: 10vh;
        width: 30vw;
    }

    .start_button {
        background: url("img/button1.jpg") no-repeat;
        background-size: 100% 100%;
        border: none;
        box-shadow: 0 0 0 1px darkslategrey;
        transition: all 100ms ease-out;
        color: yellow;
        font-family: 'Marcellus SC', serif;
        text-shadow: 2px 2px 5px black;
        outline: none;
        width: 6vw;
        height: 5vh;
        font-size: 10pt;
        margin: 1vw;
    }

    .start_text {
        font-size: 12pt;
    }

    .start_power_display {
        padding-top: 1vh;
        padding-right: 2vw;
    }

    .start_power_div {
        display: inline-flex;
    }

    table {
        margin-left: 21vw;
        margin-top: 5vh;
    }

    td {
        width: 28vw;
        padding-bottom: 1vh;
    }

    .welcome_message {
        margin: 0 auto;
        width: 40vw;
        font-family: 'Philosopher', serif;
        font-size: 16pt;
        text-shadow: 2px 2px 7px black;
    }

    .hidden {
        display: none;
    }

</style>
<script>
    var TABS_ENABLED = false;
    var CLASSES_LOADED = false;
    var RACES_LOADED = false;
    var RACE_VALIDATED = false;
    var RACIAL_BONUSES_APPLIED = false;
    var DISPLAY_POWER_COSTS = false;
    var CURRENT_TAB;
    var CURRENT_TAB_SELECTOR;
    var STRENGTH;
    var QUICKNESS;
    var INTELLIGENCE;
    var LEADERSHIP;
    var ENDURANCE;

    var STRENGTH_MODIFIERS = [];
    var QUICKNESS_MODIFIERS = [];
    var INTELLIGENCE_MODIFIERS = [];
    var LEADERSHIP_MODIFIERS = [];
    var ENDURANCE_MODIFIERS = [];

    var POWERS_ARRAY;
    var RACIAL_POWER;
    var RACIAL_POWER_ICON;
    var HALF_ELF_CHOICES = [];
    var CLASS_POWER_DETAILS = [];
    var SELECTED_POWERS = [];
    var SELECTED_POWERS_ICONS = [];
    var POWER_POINTS = 2.0;

    var CHARACTER_CLASS;
    var CHARACTER_NAME;
    var PLAYER_NAME;
    var CHARACTER_RACE;

    function activiateHalfElfTooltipster() {
        $('.half_elf_tooltip').tooltipster({
            contentCloning: true,
            theme: 'tooltipster-borderless',
            updateAnimation: 'null',
            side: ['bottom', 'top'],
            animationDuration: '0',
            delay: '0'
        });
    }

    function activateTooltipster() {
        $('.tooltip').tooltipster({
            contentCloning: true,
            theme: 'tooltipster-borderless',
            updateAnimation: 'null',
            side: ['bottom', 'top'],
            animationDuration: '0',
            delay: '0'
        });
    }

    function activateRacialTooltipster() {
        $("#racial_power_container").tooltipster({
            contentCloning: true,
            theme: 'tooltipster-borderless',
            updateAnimation: 'null',
            side: ['bottom', 'top'],
            animationDuration: '0',
            delay: '0'
        });
    }

    function activiateStartPageTooltipster() {
        $('.start_tooltip').tooltipster({
            contentCloning: true,
            theme: 'tooltipster-borderless',
            updateAnimation: 'null',
            side: ['bottom', 'top'],
            animationDuration: '0',
            delay: '0'
        });
    }

    function add(a, b) {
        return a + b;
    }

    function addRollTotalModifier(rollNum, lowRoll1, lowRoll2) {
        var rollTotal = document.getElementById("roll_total" + rollNum).innerText;
        if (rollTotal.indexOf("(") === -1) {
            rollTotal = (parseInt(rollTotal) + (parseInt(lowRoll1.innerText) + parseInt(lowRoll2.innerText)));
            var modifier = getModifier(rollTotal);
            if (rollTotal == 0) modifier = "-";
            var sign = "";
            if (modifier > 0) sign = "+";
            document.getElementById("roll_total" + rollNum).innerText = rollTotal + " (" + sign + modifier + ")";
        }
    }

    function applyHalfElfBonus(ele) {
        var currentScore = getCurrentScore(ele);
        var newScore = (parseInt(currentScore) + 3);
        var newMod = getModifier(newScore);
        var display = document.getElementById("half_elf_bonus");
        display.innerHTML = currentScore + " + 3  = " +
            "<span id='half_elf_bonus_total'>" + newScore + "</span>" + getModifierText(newMod);
    }

    function applyHalfElfPenalty(ele) {
        var currentScore = getCurrentScore(ele);
        var newScore = (parseInt(currentScore) - 3);
        var newMod = getModifier(newScore);
        var display = document.getElementById("half_elf_penalty");
        display.innerHTML = currentScore + " - 3  = " +
            "<span id='half_elf_penalty_total'>" + newScore + "</span>" + getModifierText(newMod);
    }

    function applyHalfOrcBonus(ele) {
        var currentScore = getCurrentScore(ele);
        var newScore = (parseInt(currentScore) + 4);
        var newMod = getModifier(newScore);
        var display = document.getElementById("half_orc_bonus");
        display.innerHTML = currentScore + " + 4  = " +
            "<span id='half_orc_bonus_total'>" + newScore + "</span>" + getModifierText(newMod);

        var abilities = ["Strength", "Quickness", "Intelligence", "Leadership"];
        var index = abilities.indexOf(selectText(ele));
        if (index > -1) {
            abilities.splice(index, 1);
        }

        var bonusScore = getCurrentScore(ele);
        var penalty1 = abilities[0];
        var penaltyScore1 = getScore(penalty1);
        var penalty2 = abilities[1];
        var penaltyScore2 = getScore(penalty2);
        var penalty3 = abilities[2];
        var penaltyScore3 = getScore(penalty3);

        var penalty1Container = document.getElementById("penalty_1");
        var penalty2Container = document.getElementById("penalty_2");
        var penalty3Container = document.getElementById("penalty_3");

        newScore = (parseInt(penaltyScore1) - 2);
        newMod = getModifier(newScore);
        penalty1Container.innerHTML = penalty1 + ": " + penaltyScore1 + " - 2 = " +
            "<span id='penalty_total1'>" + newScore + "</span>" + getModifierText(newMod);

        newScore = (parseInt(penaltyScore2) - 2);
        newMod = getModifier(newScore);
        penalty2Container.innerHTML = penalty2 + ": " + penaltyScore2 + " - 2 = " +
            "<span id='penalty_total2'>" + newScore + "</span>" + getModifierText(newMod);

        newScore = (parseInt(penaltyScore3) - 2);
        newMod = getModifier(newScore);
        penalty3Container.innerHTML = penalty3 + ": " + penaltyScore3 + " - 2 = " +
            "<span id='penalty_total3'>" + newScore + "</span>" + getModifierText(newMod);

    }

    function applyHighElfBonus(ele) {
        var currentScore = getCurrentScore(ele);
        var newScore = (parseInt(currentScore) + 3);
        var newMod = getModifier(newScore);
        var display = document.getElementById("high_elf_bonus");
        display.innerHTML = currentScore + " + 3  = " +
            "<span id='high_elf_bonus_total'>" + newScore + "</span>" + getModifierText(newMod);
    }

    function applyHumanBonus(ele) {
        var display = document.getElementById("human_bonus");
        if (selectText(ele).includes("changes")) {
            document.getElementById("human_penalty_select").value = "No ability changes";
            document.getElementById("human_penalty").innerHTML = "";
            display.innerHTML = "";
            return;
        }
        var currentScore = getCurrentScore(ele);
        var newScore = (parseInt(currentScore) + 2);
        var newMod = getModifier(newScore);
        display.innerHTML = currentScore + " + 2  = " +
            "<span id='human_bonus_total'>" + newScore + "</span>" + getModifierText(newMod);
    }

    function applyHumanPenalty(ele) {
        var display = document.getElementById("human_penalty");
        if (selectText(ele).includes("changes")) {
            document.getElementById("human_bonus_select").value = "No ability changes";
            document.getElementById("human_bonus").innerHTML = "";
            display.innerHTML = "";
            return;
        }
        var currentScore = getCurrentScore(ele);
        var newScore = (parseInt(currentScore) - 2);
        var newMod = getModifier(newScore);
        display.innerHTML = currentScore + " - 2  = " +
            "<span id='human_penalty_total'>" + newScore + "</span>" + getModifierText(newMod);
    }

    function applyOrcPenalty(ele) {
        var currentScore = getCurrentScore(ele);
        var newScore = (parseInt(currentScore) - 6);
        var newMod = getModifier(newScore);
        var display = document.getElementById("orc_penalty");
        display.innerHTML = currentScore + " - 6  = " +
            "<span id='orc_penalty_total'>" + newScore + "</span>" + getModifierText(newMod);
    }

    function applyWoodElfBonus(ele) {
        var currentScore = getCurrentScore(ele);
        var newScore = (parseInt(currentScore) + 3);
        var newMod = getModifier(newScore);
        var display = document.getElementById("wood_elf_bonus");
        display.innerHTML = currentScore + " + 3  = " +
            "<span id='wood_elf_bonus_total'>" + newScore + "</span>" + getModifierText(newMod);
    }

    function autoAdjustAbilitiesByClass(classCombo) {
        var abilitiesSorted = [STRENGTH, QUICKNESS, INTELLIGENCE, LEADERSHIP];
        abilitiesSorted.sort(function (a, b) {  return b - a;  });
        for (var i = 0; i < 4; i++) {
            var ability = classCombo.charAt(i);
            switch (ability) {
                case 'S':
                    STRENGTH = abilitiesSorted[i];
                    break;
                case 'Q':
                    QUICKNESS = abilitiesSorted[i];
                    break;
                case 'I':
                    INTELLIGENCE = abilitiesSorted[i];
                    break;
                case 'L':
                    LEADERSHIP = abilitiesSorted[i];
            }
        }
        update_ability_scores();
    }

    function adjustEndurance(rollNum, el) {
        var lowRoll1 = document.getElementById("roll" + rollNum + "-4");
        var lowRoll2 = document.getElementById("roll" + rollNum + "-5");
        if (selectText(el) !== "Endurance") {
            lowRoll1.classList.remove("low_end_rolls");
            lowRoll2.classList.remove("low_end_rolls");
            document.getElementById("last_plus" + rollNum).classList.remove("last_end_plus");
            addRollTotalModifier(rollNum, lowRoll1, lowRoll2);
            return;
        }
        lowRoll1.classList.add("low_end_rolls");
        lowRoll2.classList.add("low_end_rolls");
        document.getElementById("last_plus" + rollNum).classList.add("last_end_plus");


        removeRollTotalModifier(rollNum, lowRoll1, lowRoll2);
    }

    function changeTab(id, el) {
        if (!TABS_ENABLED) {
            return;
        }
        if (id !== "ability_body" && id !== "start_body") {
            document.getElementById("ability_scores").style.display = "block";
            update_ability_scores();
        }
        else {
            if (id === "start_body") {
                displaySummary();
                activiateStartPageTooltipster();
            }
            document.getElementById("ability_scores").style.display = "none";
        }
        el.classList.add("menu_tab_selected");
        CURRENT_TAB_SELECTOR.classList.remove("menu_tab_selected");
        document.getElementById(CURRENT_TAB).style.display = "none";
        document.getElementById(id).style.display = "block";
        CURRENT_TAB = id;
        CURRENT_TAB_SELECTOR = el;
    }

    function createButton(tab) {
        var button = document.createElement("button");
        button.innerText = "Set";
        button.classList.add("start_button");
        button.setAttribute("onclick", "changeTabTo(\"" + tab + "\")");
        return button;
    }

    function changeTabTo(tab) {
        switch (tab) {
            case "name":
                changeTab("name_body", document.getElementById("name_selector"));
                break;
            case "race":
                changeTab("race_body", document.getElementById("race_selector"));
                break;
            case "class":
                changeTab("class_body", document.getElementById("class_selector"));
                break;
            case "powers":
                changeTab("powers_body", document.getElementById("powers_selector"));
                break;
        }
    }

    function displaySummary() {
        var sTotal = parseInt(STRENGTH) + parseInt(sumArray(STRENGTH_MODIFIERS));
        var qTotal = parseInt(QUICKNESS) + parseInt(sumArray(QUICKNESS_MODIFIERS));
        var iTotal = parseInt(INTELLIGENCE) + parseInt(sumArray(INTELLIGENCE_MODIFIERS));
        var lTotal = parseInt(LEADERSHIP) + parseInt(sumArray(LEADERSHIP_MODIFIERS));
        var eTotal = parseInt(ENDURANCE) + parseInt(sumArray(ENDURANCE_MODIFIERS));

        var charName = document.getElementById("start_char_name");
        var player = document.getElementById("start_player");
        var race = document.getElementById("start_race");
        var className = document.getElementById("start_class");
        charName.innerHTML = "";
        player.innerHTML = "";
        race.innerHTML = "";
        className.innerHTML = "";

        CHARACTER_NAME == null ? charName.appendChild(createButton("name")) : charName.innerText = CHARACTER_NAME;
        PLAYER_NAME == null ? player.appendChild(createButton("name")) : player.innerText = PLAYER_NAME;
        CHARACTER_RACE == null ? race.appendChild(createButton("race")) : race.innerText = CHARACTER_RACE;
        CHARACTER_CLASS == null ? className.appendChild(createButton("class")) : className.innerText = CHARACTER_CLASS;

        document.getElementById("start_s").innerText = sTotal + getModifierText(getModifier(sTotal));
        document.getElementById("start_q").innerText = qTotal + getModifierText(getModifier(qTotal));
        document.getElementById("start_i").innerText = iTotal + getModifierText(getModifier(iTotal));
        document.getElementById("start_l").innerText = lTotal + getModifierText(getModifier(lTotal));
        document.getElementById("start_e").innerText = eTotal;

        document.getElementById("start_racial_powers_div").innerHTML = "";
        if (RACIAL_POWER_ICON !== undefined) {
            var racialPower = RACIAL_POWER_ICON;
            racialPower.id = racialPower.id + "_cloned";
            racialPower.setAttribute("data-tooltip-content", "#tooltip_content");
            racialPower.setAttribute("onmouseover", "update_start_racial_tooltip(this)");

            racialPower.style.marginLeft = "";
            racialPower.classList.remove("power_selected");
            racialPower.classList.remove("power_div");
            racialPower.classList.add("start_power_div");
            racialPower.classList.add("start_power_display");
            racialPower.classList.add("start_tooltip");
            document.getElementById("start_racial_powers_div").appendChild(racialPower);
        }

        document.getElementById("start_powers_div").innerHTML = "";
        if (SELECTED_POWERS_ICONS.length === 0) {
            var powers = document.getElementById("start_powers_div");
            powers.appendChild(createButton("powers"));
        }
        for (var i = 0; i < SELECTED_POWERS_ICONS.length; i++) {
            var power = SELECTED_POWERS_ICONS[i];
            power.setAttribute("data-tooltip-content", "#tooltip_content");
            power.setAttribute("onmouseover", "update_start_tooltip(this)");

            power.classList.remove("power_selected");
            power.classList.remove("power_div");
            power.classList.add("start_power_div");
            power.classList.add("start_power_display");
            power.classList.add("start_tooltip");
            document.getElementById("start_powers_div").appendChild(power);
        }
    }

    function enableTabs() {
        TABS_ENABLED = true;
        var tabs = document.getElementsByClassName("menu_tab");
        for (var i = 0; i < tabs.length; i++) {
            tabs.item(i).classList.remove("disabled_menu_item");
        }
    }

    function getModifier(num) {
        if (num > 20) {
            return 4; //19, 16, 12, 10
        }
        if (num >= 19) {
            return 3;
        }
        if (num >= 16) {
            return 2;
        }
        if (num >= 12) {
            return 1;
        }
        if (num >= 10) {
            return 0;
        }
        if (num >= 6) {
            return -1;
        }
        if (num >= 3) {
            return -2;
        }
        return -3;
    }

    function getModifierText(num) {
        return " (" + (num > 0 ? '+':'') + num + ")";
    }

    function getRandomInt(max) {
        return Math.floor(Math.random() * Math.floor(max)) + 1 //don't include 0;
    }

    function hide_class_modal() {
        document.getElementById("class_modal").classList.add("hidden");
    }

    function hide_race_modal() {
        document.getElementById("race_modal").classList.add("hidden");
    }

    function loadClassDescription(ele) {
        var selectedClass = selectText(ele).split("(")[0].trim();
        $.get("/class/classDescription/" + selectedClass, function(data, status) {
            document.getElementById("class_description").innerText = data;
            loadClassTraits(selectedClass);
            loadClassRestrictions(selectedClass);
            var classCombo = selectText(ele).split("(")[1].replace("(", "").replace(")", "").trim();
            autoAdjustAbilitiesByClass(classCombo);
            // loadClassPowers(selectedClass);
        });
    }

    function loadClassList() {
        if (CLASSES_LOADED) {
            return;
        }
        $.get("/class/classList", function(data, status){
            for (var i=0; i < data.length; i++) {
                var className = data[i];
                var classSelect = document.getElementById("class_select");
                var option = document.createElement("option");
                option.value = className;
                option.innerText = className;
                classSelect.appendChild(option);
            }
        });
        CLASSES_LOADED = true;
    }

    function loadClassPowers(className) {
        SELECTED_POWERS = [];
        SELECTED_POWERS_ICONS = [];
        POWER_POINTS = 2.0;
        document.getElementById("power_warning").classList.add("hidden");
        document.getElementById("power_title").innerText = className;
        document.getElementById("power_title_container").classList.remove("hidden");
        document.getElementById("select_class_first").classList.add("hidden");

        $.get("/class/classPowers/" + className, function(data, status) {
            var powersDisplay = document.getElementById("powers_display");
            var powerTable = document.getElementById("power_table");
            document.getElementById("points_remaining").innerHTML = "You have <b id='points'>2</b> power point(s) remaining";
            powerTable.innerHTML = "";
            POWERS_ARRAY = data;
            CLASS_POWER_DETAILS = [];
            for (var i = 0; i < data.length; i+=2) {
                CLASS_POWER_DETAILS.push(data[i]);
                CLASS_POWER_DETAILS.push(data[i+1]);
                var powerRow = document.createElement("tr");
                var cell1 = document.createElement("td");
                var cell2 = document.createElement("td");
                var div1 = document.createElement("div");
                var div2 = document.createElement("div");

                var powerName = data[i].name;
                var powerDescription = data[i].description;
                var imgSrc = data[i].imageSrc;
                var powerName2 = data[i+1].name;
                var powerDescription2 = data[i+1].description;
                var imgSrc2 = data[i+1].imageSrc;

                div1.id = "power-" + i;
                div2.id = "power-" + (i+1);
                div1.classList.add("power_div");
                div2.classList.add("power_div");
                div1.classList.add("tooltip");
                div2.classList.add("tooltip");
                div1.setAttribute("data-tooltip-content", "#tooltip_content");
                div2.setAttribute("data-tooltip-content", "#tooltip_content");
                div1.setAttribute("onmouseover", "update_tooltip(" + i + ")");
                div2.setAttribute("onmouseover", "update_tooltip(" + (i+1) + ")");
                div1.setAttribute("onclick", "powerSelected(this, " + i + ")");
                div2.setAttribute("onclick", "powerSelected(this, " + (i+1) + ")");

                var power = data[i];
                var power2 = data[i+1];

                var powerIcon = document.createElement("img");
                powerIcon.src = power.imageSrc;
                var powerTitle = document.createElement("p");
                powerTitle.classList.add("power_name");
                powerTitle.innerText = power.name;
                div1.appendChild(powerIcon);
                div1.appendChild(powerTitle);

                powerIcon = document.createElement("img");
                powerIcon.src = power2.imageSrc;
                powerTitle = document.createElement("p");
                powerTitle.classList.add("power_name");
                powerTitle.innerText = power2.name;
                div2.appendChild(powerIcon);
                div2.appendChild(powerTitle);

                cell1.appendChild(div1);
                cell2.appendChild(div2);

                powerRow.appendChild(cell1);
                powerRow.appendChild(cell2);
                powerTable.appendChild(powerRow);
            }
            activateTooltipster();
        })
    }

    function loadClassRestrictions(className) {
        $.get("/class/classRestrictions/" + className, function(data, status) {
            var restrictionList = document.getElementById("class_restrictions");
            restrictionList.innerHTML = "";
            for (var i = 0; i < data.length; i++) {
                var trait = data[i];
                var listElement = document.createElement("li");
                listElement.innerText = trait;
                restrictionList.appendChild(listElement);
            }
            document.getElementById("restrictions_header").classList.remove("hidden");
            document.getElementById("save_class").classList.remove("hidden");
        })
    }

    function loadClassTraits(className) {
        $.get("/class/classTraits/" + className, function(data, status) {
            var traitList = document.getElementById("class_traits");
            traitList.innerHTML = "";
            for (var i = 0; i < data.length; i++) {
                var trait = data[i];
                var listElement = document.createElement("li");
                listElement.innerText = trait;
                traitList.appendChild(listElement);
            }
            document.getElementById("traits_header").classList.remove("hidden");
        })
    }

    function loadRacialPowers(race) {
        $.get("/race/racialPowers/" + race, function(data, status) {
            RACIAL_POWER = data;

            var div = document.getElementById("racial_power_container");
            var powerIcon = document.createElement("img");
            powerIcon.src = data.imageSrc;
            var powerList = document.getElementById("racial_powers");
            powerList.innerHTML = data.name;
            document.getElementById("racial_powers_header").classList.remove("hidden");

            div.innerHTML = "";
            div.appendChild(powerIcon);
            div.appendChild(powerList);
            RACIAL_POWER_ICON = div.cloneNode(true);

            activateRacialTooltipster();
        })
    }

    function loadRacialTraits(race) {
        $.get("/race/racialTraits/" + race, function(data, status) {
            var traitList = document.getElementById("racial_traits");
            traitList.innerHTML = "";
            for (var i = 0; i < data.length; i++) {
                var trait = data[i];
                var listElement = document.createElement("li");
                listElement.innerText = trait;
                traitList.appendChild(listElement);
            }
            document.getElementById("racial_traits_header").classList.remove("hidden");
        })
    }

    function loadRaceDescription(ele) {
        var selectedRace = selectText(ele).split("(")[0].trim();
        $.get("/race/raceDescription/" + selectedRace, function(data, status) {
            document.getElementById("race_description").innerText = data;
            loadRacialTraits(selectedRace);
            loadRacialPowers(selectedRace);
            // autoAdjustAbilitiesByRace(selectedRace);
        });
        document.getElementById("save_race").classList.remove("hidden");
    }

    function loadRaceList() {
        if (RACES_LOADED) {
            return;
        }
        $.get("/race/raceList", function(data, status){
            for (var i=0; i < data.length; i++) {
                var race = data[i];
                var raceSelect = document.getElementById("race_select");
                var option = document.createElement("option");
                option.value = race;
                option.innerText = race;
                raceSelect.appendChild(option);
            }
        });
        RACES_LOADED = true;
    }

    function powerSelected(ele, position) {
        var powerCost = POWERS_ARRAY[position].powerCost;
        var powerName = POWERS_ARRAY[position].name;
        if (ele.classList.contains("power_selected")) {
            ele.classList.remove("power_selected");
            POWER_POINTS = (parseFloat(POWER_POINTS) + parseFloat(powerCost));
            document.getElementById("power_warning").classList.add("hidden");
            var index = SELECTED_POWERS.indexOf(powerName);
            if (index > -1) {
                SELECTED_POWERS.splice(index, 1);
                SELECTED_POWERS_ICONS.splice(index, 1);
            }
            document.getElementById("points").innerText = POWER_POINTS.toString();
        }
        else {
            if (POWER_POINTS < powerCost) {
                document.getElementById("power_warning").classList.remove("hidden");
                return; //don't do anything. Player has already selected too many skills;
            }
            ele.classList.add("power_selected");
            SELECTED_POWERS.push(powerName);
            var clonedIcon = ele.cloneNode(true);
            clonedIcon.id = clonedIcon.id + "_cloned";
            clonedIcon.classList.remove("tooltip");
            SELECTED_POWERS_ICONS.push(clonedIcon);
            POWER_POINTS = (parseFloat(POWER_POINTS) - parseFloat(powerCost));
            document.getElementById("points").innerText = POWER_POINTS.toString();
        }
        showSelectedPowers();
    }

    function racialModifier(sum, total) {
        if (sum == 0) {
            return "";
        }
        return "<span class='racial_modifier'>" + sum + " = " + "<span><u>" + total + "</u></span>"
    }

    function removeRollTotalModifier(rollNum, lowRoll1, lowRoll2) {
        var rollTotal = document.getElementById("roll_total" + rollNum).innerText;
        if (rollTotal.indexOf("(") !== -1) {
            rollTotal = (parseInt(rollTotal) - (parseInt(lowRoll1.innerText) + parseInt(lowRoll2.innerText))).toString();
            document.getElementById("roll_total" + rollNum).innerText = rollTotal.split(" ")[0];
        }
    }

    function resetAbilityModifiers() {
        STRENGTH_MODIFIERS = [];
        QUICKNESS_MODIFIERS = [];
        INTELLIGENCE_MODIFIERS = [];
        LEADERSHIP_MODIFIERS = [];
        ENDURANCE_MODIFIERS = [];
    }

    function resetClassSelection() {
        document.getElementById("class_select").value = "";
        document.getElementById("class_description").innerText = "";
        document.getElementById("traits_header").classList.add("hidden");
        document.getElementById("restrictions_header").classList.add("hidden");
        document.getElementById("class_traits").innerHTML = "";
        document.getElementById("class_restrictions").innerHTML = "";

        document.getElementById("char_class").innerText = "";
        document.getElementById("char_class").classList.add("hidden");
    }

    function resetRaceSelection() {
        document.getElementById("race_select").value = "";
        document.getElementById("race_description").innerText = "";
        document.getElementById("racial_traits_header").classList.add("hidden");
        document.getElementById("racial_powers_header").classList.add("hidden");
        document.getElementById("racial_traits").innerHTML = "";
        document.getElementById("racial_powers").innerHTML = "";

        document.getElementById("char_race").innerText = "";
        document.getElementById("char_race").classList.add("hidden");
    }

    function rollAttribute(rollNum, el) {
        el.classList.add("disabled_button");
        el.disabled = true;
        var rolls = [];
        for (var i = 0; i < 5; i++) {
            rolls.push(getRandomInt(4));
        }
        rolls = rolls.sort(function (a, b) {  return b - a;  });

        for (var roll = 1; roll <= 5; roll++) {
            var element = document.getElementById("roll" + rollNum + "-" + roll).innerText = rolls[roll-1];
        }
        var rollTotal = rolls.reduce(add, 0);
        var modifier = getModifier(rollTotal);
        if (modifier > 0) {
            rollTotal = rollTotal + " (+" + modifier + ")";
        }
        else {
            rollTotal = rollTotal + " (" + modifier + ")";
        }
        document.getElementById("roll_total" + rollNum).innerText = rollTotal;
    }

    function saveAbilities() {
        var validated = validate();
        if (validated) {
            document.getElementById("validate_error").style.display = "none";
            enableTabs();
            loadClassList();
            resetClassSelection();
            loadRaceList();
            resetRaceSelection();
            //TODO: Reset powers selection
            changeTab("class_body", document.getElementById("class_selector"));
        }
        else {
            document.getElementById("validate_error").style.display = "block";
        }
    }

    function saveClass() {
        var selectedClass = document.getElementById("class_select").value.split("(")[0].trim();
        var selectedRace = CHARACTER_RACE;
        var validClass = validate_class(selectedRace, selectedClass);
        if (validClass) {
            CHARACTER_CLASS = selectedClass;
            document.getElementById("class_validate_error").style.display = "none";
            document.getElementById("char_class").innerText = selectedClass;
            document.getElementById("char_class").classList.remove("hidden");
            if (CHARACTER_RACE !== undefined) {
                changeTab("powers_body", document.getElementById("powers_selector"));
            }
            else {
                changeTab("race_body", document.getElementById("race_selector"));
            }
            loadClassPowers(selectedClass);
        }
        else {
            var errorMessage = document.getElementById("class_validate_error");
            errorMessage.innerText = selectedRace + "s cannot be " + selectedClass + "s. Select a different class or a different race.";
            document.getElementById("class_validate_error").style.display = "block";
        }
        showSelectedPowers();
    }

    function saveRace() {
        var selectedClass = CHARACTER_CLASS;
        var selectedRace = document.getElementById("race_select").value;
        RACE_VALIDATED = validate_race(selectedRace, selectedClass);
        if (RACE_VALIDATED) {
            showRaceModal(selectedRace);
        }
        else {
            var errorMessage = document.getElementById("race_validate_error");
            errorMessage.innerText = selectedRace + "s cannot be " + selectedClass + "s. Select a different class or a different race.";
            document.getElementById("race_validate_error").style.display = "block";
        }
    }

    function saveRace2(selectedRace) {
        RACIAL_BONUSES_APPLIED = true;
        document.getElementById("race_modal").classList.add("hidden");
        if (RACE_VALIDATED) {
            CHARACTER_RACE = selectedRace;
            document.getElementById("race_validate_error").style.display = "none";
            document.getElementById("char_race").innerText = selectedRace;
            document.getElementById("char_race").classList.remove("hidden");
            changeTab("powers_body", document.getElementById("powers_selector"));
        }
    }

    function selectText(element) {
        return element.options[element.selectedIndex].text;
    }

    function selectValue(element) {
        return element.options[element.selectedIndex].value;
    }

    function showRaceModal(race) {
        var selectedRace = race;
        race = race.toLowerCase();
        race = race.replace("-", "_");
        race = race.replace(" ", "_");

        var acceptButton = document.getElementById("accept_modal_button");
        acceptButton.setAttribute("onclick", "validate_"+race+"('"+selectedRace+"')")

        var raceModal = document.getElementById("race_modal");
        var raceModalBody = document.getElementById("race_modal_body");
        var raceModalContent = document.getElementById(race + "_modal_content");
        var contentClone = raceModalContent.cloneNode(true);
        var raceModalHeader = document.getElementById("race_modal_header");

        var HalfElfPowersDiv = document.createElement("div");
        HalfElfPowersDiv.id = "half_elf_powers_div";
        HalfElfPowersDiv.style.textAlign = "center";

        raceModalHeader.innerText = selectedRace + " Racial Bonuses";
        raceModalBody.innerHTML = "";
        raceModalBody.appendChild(contentClone);
        raceModalBody.appendChild(HalfElfPowersDiv);
        raceModal.classList.remove("hidden");

        switch(selectedRace) {
            case "Dwarf":
                showDwarfAdjustments();
                break;
            case "Half-Elf":
                showHalfElfPowerChoices();
                break;
            case "High Elf":
                showHighElfAdjustments();
                break;
            case "Hobbit":
                showHobbitAdjustments();
                break;
            case "Orc":
                showOrcAdjustments();
                break;
            case "Wood Elf":
                showWoodElfAdjustments();
                break;
        }
    }

    function showDwarfAdjustments() {
        var currentS = STRENGTH;
        var currentE = ENDURANCE;
        var currentI = INTELLIGENCE;

        var newS = (parseInt(currentS) + 2);
        var newE = (parseInt(currentE) + 2);
        var newI = (parseInt(currentI) - 4);

        var sSpan = document.getElementById("dwarf_s");
        var eSpan = document.getElementById("dwarf_e");
        var iSpan = document.getElementById("dwarf_i");

        var newMod = getModifier(newS);
        sSpan.innerText = currentS + " + 2 = " + newS + getModifierText(newMod);

        newMod = getModifier(newE);
        eSpan.innerText = currentE + " + 2 = " + newE;

        newMod = getModifier(newI);
        iSpan.innerText = currentI + " - 4 = " + newI + getModifierText(newMod);
    }

    function showHalfElfPowerChoices() {
        RACIAL_POWER = undefined;
        RACIAL_POWER_ICON = undefined;
        var humanPower;
        var highElfPower;
        var woodElfPower;
        $.get("/race/HalfElfChoice", function(data, status) {
            HALF_ELF_CHOICES = data;
            humanPower = data[0];
            highElfPower = data[1];
            woodElfPower = data[2];

            var humanDiv = createPower(humanPower, 0);
            var highElfDiv = createPower(highElfPower, 1);
            var woodElfDiv = createPower(woodElfPower, 2);

            var powerDiv = document.getElementById("half_elf_powers_div");
            powerDiv.appendChild(humanDiv);
            powerDiv.appendChild(highElfDiv);
            powerDiv.appendChild(woodElfDiv);

            activiateHalfElfTooltipster();
        });
    }

    function createPower(power, index) {
        var div = document.createElement("div");
        var imageSrc = document.createElement("img");
        var powerTitle = document.createElement("p");

        div.id = "half_elf-" + index;
        div.classList.add("power_div");
        div.classList.add("half_elf_tooltip");
        div.setAttribute("data-tooltip-content", "#tooltip_content");
        div.setAttribute("onmouseover", "update_half_elf_tooltip(this, " + index + ")");
        div.setAttribute("onclick", "select_race_power(this, " + index + ")");
        div.style.marginLeft = "2vw";

        imageSrc.src = power.imageSrc;
        powerTitle.innerText = power.name;
        powerTitle.classList.add("power_name");

        div.appendChild(imageSrc);
        div.appendChild(powerTitle);
        return div;
    }

    function select_race_power(ele, index) {
        for (var i = 0; i < 3; i++) {
            var div = document.getElementById("half_elf-" + i);
            div.classList.remove("power_selected");
        }
        ele.classList.add("power_selected");
        RACIAL_POWER = HALF_ELF_CHOICES[index];
        RACIAL_POWER_ICON = ele;
    }

    function showHighElfAdjustments() {
        var currentS = STRENGTH;
        var newS = (parseInt(currentS) - 2);
        var sSpan = document.getElementById("high_elf_s");

        var newMod = getModifier(newS);
        sSpan.innerText = currentS + " - 2 = " + newS + getModifierText(newMod);
    }

    function showHobbitAdjustments() {
        var currentQ = STRENGTH;
        var currentI = ENDURANCE;
        var currentS = INTELLIGENCE;

        var newQ = (parseInt(currentQ) + 2);
        var newI = (parseInt(currentI) + 2);
        var newS = (parseInt(currentS) - 4);

        var qSpan = document.getElementById("hobbit_q");
        var iSpan = document.getElementById("hobbit_i");
        var sSpan = document.getElementById("hobbit_s");

        var newMod = getModifier(newQ);
        qSpan.innerText = currentQ + " + 2 = " + newQ + getModifierText(newMod);

        newMod = getModifier(newI);
        iSpan.innerText = currentI + " + 2 = " + newI + getModifierText(newMod);

        newMod = getModifier(newS);
        sSpan.innerText = currentS + " - 4 = " + newS + getModifierText(newMod);
    }

    function showOrcAdjustments() {
        var currentS = STRENGTH;
        var newS = (parseInt(currentS) + 4);
        var sSpan = document.getElementById("orc_s");

        var newMod = getModifier(newS);
        sSpan.innerText = currentS + " + 4 = " + newS + getModifierText(newMod);
    }

    function showWoodElfAdjustments() {
        var currentS = STRENGTH;
        var newS = (parseInt(currentS) - 2);
        var sSpan = document.getElementById("wood_elf_s");

        var newMod = getModifier(newS);
        sSpan.innerText = currentS + " - 2 = " + newS + getModifierText(newMod);
    }

    function showSelectedPowers() {
        var powersContainer = document.getElementById("char_powers_container");
        powersContainer.innerHTML = "";
        var powersHeader = document.createElement("span");
        powersHeader.innerHTML = "<b>Powers: </b>";
        powersContainer.appendChild(powersHeader);

        for (var i = 0; i < SELECTED_POWERS.length; i++) {
            var powerDiv = document.createElement("div");
            var powerName = document.createElement("span");
            powerDiv.style.display = "list-item";
            powerName.innerText = SELECTED_POWERS[i];
            powerDiv.appendChild(powerName);
            powersContainer.appendChild(powerDiv);
        }
    }

    function startCreation() {
        document.getElementById("welcome_body").style.display = "none";
        document.getElementById("ability_body").style.display = "block";
        CURRENT_TAB = "ability_body";
        CURRENT_TAB_SELECTOR = document.getElementById("ability_selector");
        CURRENT_TAB_SELECTOR.classList.add("menu_tab_selected");
    }

    function sumArray(array) {
        var sum = 0;
        for(var i = 0; i < array.length; i++) {
            sum += parseInt(array[i]);
        }
        return sum;
    }

    function update_ability_scores() {
        var sTotal = parseInt(STRENGTH) + parseInt(sumArray(STRENGTH_MODIFIERS));
        var qTotal = parseInt(QUICKNESS) + parseInt(sumArray(QUICKNESS_MODIFIERS));
        var iTotal = parseInt(INTELLIGENCE) + parseInt(sumArray(INTELLIGENCE_MODIFIERS));
        var lTotal = parseInt(LEADERSHIP) + parseInt(sumArray(LEADERSHIP_MODIFIERS));
        var eTotal = parseInt(ENDURANCE) + parseInt(sumArray(ENDURANCE_MODIFIERS));

        var sMod = getModifier(sTotal);
        var qMod = getModifier(qTotal);
        var iMod = getModifier(iTotal);
        var lMod = getModifier(lTotal);

        document.getElementById("ability_s").innerHTML = sTotal + getModifierText(sMod);
        document.getElementById("ability_q").innerHTML = qTotal + getModifierText(qMod);
        document.getElementById("ability_i").innerHTML = iTotal + getModifierText(iMod);
        document.getElementById("ability_l").innerHTML = lTotal + getModifierText(lMod);
        document.getElementById("ability_e").innerHTML = eTotal;
    }

    function update_character_name(ele) {
        CHARACTER_NAME = ele.value;
        document.getElementById("char_name").innerHTML = "<u>" + ele.value + "</u>";
    }

    function update_player_name(ele) {
        PLAYER_NAME = ele.value;
        document.getElementById("player_name").innerHTML = "<u>" + ele.value + "</u>";
    }

    function update_half_elf_tooltip(ele, index) {
        var powerInfo = HALF_ELF_CHOICES[index];

        var div = document.createElement("div");
        div.style = "width:35vw;";
        div.id = "start_power_container_";

        var powerIcon = document.createElement("img");
        powerIcon.id = "start_power_icon_";

        var powerName = document.createElement("span");
        powerName.style = "font-size:14pt;vertical-align:top;padding-left: 1vw;";
        powerName.id = "start_tooltip_power_name_";

        var powerDescription = document.createElement("p");
        powerDescription.style = "margin-top:0;font-size:10pt;";
        powerDescription.id = "start_tooltip_power_description_";

        powerIcon.src = powerInfo.imageSrc;
        powerName.innerText = powerInfo.name;
        powerDescription.innerText = powerInfo.description;
        div.appendChild(powerIcon);
        div.appendChild(powerName);
        div.appendChild(powerDescription);

        updateHalfElfTooltipster(index, div);

    }

    function update_racial_tooltip() {
        var div = document.createElement("div");
        div.style = "width:35vw;";
        div.id = "power_container";

        var powerIcon = document.createElement("img");
        powerIcon.id = "power_icon";

        var powerName = document.createElement("span");
        powerName.style = "font-size:14pt;vertical-align:top;padding-left: 1vw;";
        powerName.id = "tooltip_power_name";

        var powerDescription = document.createElement("p");
        powerDescription.style = "margin-top:0;font-size:10pt;";
        powerDescription.id = "tooltip_power_description";

        var currentPower = RACIAL_POWER;
        powerIcon.src = currentPower.imageSrc;
        powerName.innerText = currentPower.name;
        powerDescription.innerText = currentPower.description;
        div.appendChild(powerIcon);
        div.appendChild(powerName);
        div.appendChild(powerDescription);

        updateRacialTooltipster(div);

    }

    function update_start_racial_tooltip(ele) {
        var powerInfo = RACIAL_POWER;

        var div = document.createElement("div");
        div.style = "width:35vw;";
        div.id = "start_power_container_";

        var powerIcon = document.createElement("img");
        powerIcon.id = "start_power_icon_";

        var powerName = document.createElement("span");
        powerName.style = "font-size:14pt;vertical-align:top;padding-left: 1vw;";
        powerName.id = "start_tooltip_power_name_";

        var powerDescription = document.createElement("p");
        powerDescription.style = "margin-top:0;font-size:10pt;";
        powerDescription.id = "start_tooltip_power_description_";

        powerIcon.src = powerInfo.imageSrc;
        powerName.innerText = powerInfo.name;
        powerDescription.innerText = powerInfo.description;
        div.appendChild(powerIcon);
        div.appendChild(powerName);
        div.appendChild(powerDescription);

        updateStartTooltipster(ele, div);

    }

    function update_start_tooltip(ele) {
        var powerDivName = ele.childNodes[1].innerText;
        var powerInfo = searchPowerInfo(powerDivName);

        var div = document.createElement("div");
        div.style = "width:35vw;";
        div.id = "start_power_container_";

        var powerIcon = document.createElement("img");
        powerIcon.id = "start_power_icon_";

        var powerName = document.createElement("span");
        powerName.style = "font-size:14pt;vertical-align:top;padding-left: 1vw;";
        powerName.id = "start_tooltip_power_name_";

        var powerDescription = document.createElement("p");
        powerDescription.style = "margin-top:0;font-size:10pt;";
        powerDescription.id = "start_tooltip_power_description_";

        powerIcon.src = powerInfo.imageSrc;
        powerName.innerText = powerInfo.name;
        powerDescription.innerText = powerInfo.description;
        div.appendChild(powerIcon);
        div.appendChild(powerName);
        div.appendChild(powerDescription);

        updateStartTooltipster(ele, div);
    }

    function searchPowerInfo(powerName) {
        for (var i = 0; i < CLASS_POWER_DETAILS.length; i++) {
            var power = CLASS_POWER_DETAILS[i];
            if (power.name === powerName.trim()) {
                return power;
            }
        }
    }

    function update_tooltip(position) {
        var div = document.createElement("div");
        div.style = "width:35vw;";
        div.id = "power_container";

        var powerIcon = document.createElement("img");
        powerIcon.id = "power_icon";

        var powerName = document.createElement("span");
        powerName.style = "font-size:14pt;vertical-align:top;padding-left: 1vw;";
        powerName.id = "tooltip_power_name";

        var pointsRemaining = document.createElement("span");
        pointsRemaining.style.color = "yellow";

        var powerDescription = document.createElement("p");
        powerDescription.style = "margin-top:0;font-size:10pt;";
        powerDescription.id = "tooltip_power_description";

        var currentPower = POWERS_ARRAY[position];
        powerIcon.src = currentPower.imageSrc;
        powerName.innerText = currentPower.name;
        powerDescription.innerText = currentPower.description;

        var costPrefix = "";
        if (currentPower.powerCost == .5) {
            costPrefix = "0";
        }
        pointsRemaining.innerHTML = "<br>Power Cost: " + costPrefix + currentPower.powerCost;
        div.appendChild(powerIcon);
        div.appendChild(powerName);
        div.appendChild(pointsRemaining);
        div.appendChild(powerDescription);

        updateTootipster(div, position);
    }

    function updateHalfElfTooltipster(index, div) {
        var id = "#" + "half_elf-" + index;
        $(id).tooltipster('content', div)
            .tooltipster('open');
    }

    function updateRacialTooltipster(div) {
        $("#racial_power_container").tooltipster('content', div)
            .tooltipster('open');
    }

    function updateStartTooltipster(power, div) {
        var id = "#" + power.id;
        $(id).tooltipster('content', div)
            .tooltipster('open');
    }

    function updateTootipster(div, position) {
        var divId = "#power-" + position;
        $(divId).tooltipster('content', div)
                .tooltipster('open');
        $.tooltipster.group('power_div');
    }

    function validate() {
        var abilities = [];
        for (var i = 1; i <= 5; i++) {
            abilities.push(document.getElementById("select" + i));
        }
        for (var j = 0; j < 5; j++) {
            var element = abilities[j];
            for (var k = 0; k < 5; k++) {
                if (j === k) continue;
                var e = abilities[k];
                if (e.options[e.selectedIndex].text === element.options[element.selectedIndex].text) {
                    return false;
                }
            }
        }
        for (var h = 0; h < 5; h++) {
            e = abilities[h];
            if (e.options[e.selectedIndex].text === "Strength") {
                STRENGTH = document.getElementById("roll_total" + (h+1)).innerText.split(" ")[0];
            }
            if (e.options[e.selectedIndex].text === "Quickness") {
                QUICKNESS = document.getElementById("roll_total" + (h+1)).innerText.split(" ")[0];
            }
            if (e.options[e.selectedIndex].text === "Intelligence") {
                INTELLIGENCE = document.getElementById("roll_total" + (h+1)).innerText.split(" ")[0];
            }
            if (e.options[e.selectedIndex].text === "Leadership") {
                LEADERSHIP = document.getElementById("roll_total" + (h+1)).innerText.split(" ")[0];
            }
            if (e.options[e.selectedIndex].text === "Endurance") {
                ENDURANCE = document.getElementById("roll_total" + (h+1)).innerText.split(" ")[0];
             }
        }
        return true;
    }

    function validate_class(race, className) {
        if (race === undefined) {
            return true;
        }
        var data = {"selectedRace": race, "selectedClass": className};
        var json = JSON.stringify(data);
        var isValid = false;
        $.ajax({
            url:"/race/validate",
            type:"POST",
            data:json,
            async: false,
            contentType:"application/json; charset=utf-8",
            dataType:"json",
            success: function(response){
                isValid = response;
            }
        });
        return isValid;
    }

    function validate_dwarf(race) {
        resetAbilityModifiers();
        STRENGTH_MODIFIERS.push(2);
        ENDURANCE_MODIFIERS.push(2);
        INTELLIGENCE_MODIFIERS.push(-4);
        update_ability_scores();
        saveRace2(race);
    }

    function validate_half_elf(race) {
        resetAbilityModifiers();
        if (RACIAL_POWER === undefined) {
            document.getElementById("race_error").innerText = "*Select a racial power*";
            document.getElementById("race_error").classList.remove("hidden");
            return;
        }
        else {
            document.getElementById("race_error").classList.add("hidden");
        }
        var bonus = document.getElementById("half_elf_bonus_total").innerText;
        var penalty = document.getElementById("half_elf_penalty_total").innerText;

        var bonusAbility = selectText(document.getElementById("half_elf_bonus_select"));
        var penaltyAbility = selectText(document.getElementById("half_elf_penalty_select"));
        if (bonusAbility === penaltyAbility) {
            document.getElementById("race_error").innerText = "*Bonuses and Penalties cannot be applied to the same ability*";
            document.getElementById("race_error").classList.remove("hidden");
            return;
        }
        else {
            document.getElementById("race_error").classList.add("hidden");
        }

        add_to_modifiers(bonusAbility, 3);
        add_to_modifiers(penaltyAbility, -3);
        update_ability_scores();
        saveRace2(race);
    }

    function validate_half_orc(race) {
        resetAbilityModifiers();
        var penaltyAbilities = ["Strength", "Quickness", "Intelligence", "Leadership"];
        var bonusAbility = selectText(document.getElementById("half_orc_bonus_select"));

        var index = penaltyAbilities.indexOf(bonusAbility);
        if (index > -1) {
            penaltyAbilities.splice(index, 1);
        }

        add_to_modifiers(bonusAbility, 4);
        for (var i; i < penaltyAbilities.length; i++) {
            add_to_modifiers(penaltyAbilities[i], -2);
        }
        update_ability_scores();
        saveRace2(race);
    }

    function validate_high_elf(race) {
        resetAbilityModifiers();

        var bonusAbility = selectText(document.getElementById("high_elf_bonus_select"));
        add_to_modifiers(bonusAbility, 3);
        STRENGTH_MODIFIERS.push(-2);

        update_ability_scores();
        saveRace2(race);
    }

    function validate_hobbit(race) {
        resetAbilityModifiers();
        QUICKNESS_MODIFIERS.push(2);
        INTELLIGENCE_MODIFIERS.push(2);
        STRENGTH_MODIFIERS.push(-4);
        update_ability_scores();
        saveRace2(race);
    }

    function validate_human(race) {
        resetAbilityModifiers();

        var bonusAbility = selectText(document.getElementById("human_bonus_select"));
        var penaltyAbility = selectText(document.getElementById("human_penalty_select"));
        if (bonusAbility === penaltyAbility) {
            document.getElementById("race_error").classList.remove("hidden");
            return;
        }
        else {
            document.getElementById("race_error").classList.add("hidden");
        }

        if (bonusAbility.includes("changes") || penaltyAbility.includes("changes")) {
            saveRace2(race);
            return;
        }

        add_to_modifiers(bonusAbility, 2);
        add_to_modifiers(penaltyAbility, -2);
        update_ability_scores();
        saveRace2(race);
    }

    function validate_orc(race) {
        resetAbilityModifiers();

        STRENGTH_MODIFIERS.push(4);
        var penaltyAbility = selectText(document.getElementById("orc_penalty_select"));

        add_to_modifiers(penaltyAbility, -6);
        update_ability_scores();
        saveRace2(race);
    }

    function validate_wood_elf(race) {
        resetAbilityModifiers();

        var bonusAbility = selectText(document.getElementById("wood_elf_bonus_select"));
        add_to_modifiers(bonusAbility, 3);
        STRENGTH_MODIFIERS.push(-2);

        update_ability_scores();
        saveRace2(race);
    }

    function validate_race(race, className) {
        if (className === undefined) {
            return true;
        }
        var json = JSON.stringify({"selectedRace": race, "selectedClass": className});
        var isValid = false;
        $.ajax({
            url:"/race/validate",
            type:"POST",
            data:json,
            async: false,
            contentType:"application/json; charset=utf-8",
            dataType:"json",
            success: function(response){
                isValid = response;
            }
        });
        return isValid;
    }

    window.onclick = function(event) {
        var modal = document.getElementById("race_modal");
        var modal2 = document.getElementById("class_modal");
        if (event.target == modal || event.target == modal2) {
            modal.classList.add("hidden");
            modal2.classList.add("hidden");
        }
    };

    function add_to_modifiers(mod, value) {
        switch (mod) {
            case "Strength":
                STRENGTH_MODIFIERS.push(value);
                break;
            case "Quickness":
                QUICKNESS_MODIFIERS.push(value);
                break;
            case "Intelligence":
                INTELLIGENCE_MODIFIERS.push(value);
                break;
            case "Leadership":
                LEADERSHIP_MODIFIERS.push(value);
                break;
            case "Endurance":
                ENDURANCE_MODIFIERS.push(value);
                break;
        }
    }

    function getCurrentScore(ele) {
        switch (selectText(ele)) {
            case "Strength":
                return STRENGTH;
            case "Quickness":
                return QUICKNESS;
            case "Intelligence":
                return INTELLIGENCE;
            case "Leadership":
                return LEADERSHIP;
        }
    }

    function getScore(ability) {
        switch (ability) {
            case "Strength":
                return STRENGTH;
            case "Quickness":
                return QUICKNESS;
            case "Intelligence":
                return INTELLIGENCE;
            case "Leadership":
                return LEADERSHIP;
        }
    }

</script>
<body id="body">
<div id="middlePanel">
    <div id="menu">
        <div id="characterCreationHeader"><span>New Character<br> Creation</span></div>
        <button id="ability_selector" class="menu_tab" onclick="changeTab('ability_body', this)">Ability Scores</button>
        <button id="class_selector" class="menu_tab disabled_menu_item" onclick="changeTab('class_body', this)">Class</button>
        <button id="race_selector" class="menu_tab disabled_menu_item" onclick="changeTab('race_body', this)">Race</button>
        <button id="powers_selector" class="menu_tab disabled_menu_item" onclick="changeTab('powers_body', this)">Powers</button>
        <button id="name_selector" class="menu_tab disabled_menu_item" onclick="changeTab('name_body', this)">Name</button>
        <button id="start_selector" class="menu_tab disabled_menu_item" onclick="changeTab('start_body', this)">Start</button>
    </div>
    <div class="welcome_message" id="welcome_body" style="text-align: center;font-size: 17pt;margin-top: 10vh;">
        <p>While normal Castle Adventure allows you to roll physical dice, Osp-Garath is...different.
            For characters created specifically to enter the tower and once within the tower itself, all rolls
            will be made for you. <i>When</i> you choose to roll is entirely up to you and is your way of
            deciding when random probability and chance will come in to reality.</p>
        <button class="game_button" onclick="startCreation()" style="margin: 0 35%;">I Understand</button>
    </div>
    <div id="ability_body" style="display: none;">
        <div class="welcome_message" style="font-size:12pt; width:51vw; text-align:center;">
            <!--<p>Each character will roll 5d4 five times, once for each ability score (Strength, Quickness, Intelligence, and Leadership).-->
                <!--One of the five rolls will be used for your character's endurance, removing the two lowest dice values-->
                <!--from that roll. You may choose which roll to assign to each ability.</p>-->
            <p>Conforming with standard Castle Adventure rules, you will only have one chance to roll for each
                ability score. Therefore, choose wisely when to make that roll.</p>
        </div>
        <div id="row1_ability" class="ability_row">
            <button class="game_button ability_button" onclick="rollAttribute(1, this)" style="display:inline-block;">First Roll</button>
            <div class="roll_display" style="display:inline-flex;">
                <div class="roll_numbers">
                    <span id="roll1-1" class="roll_span">0</span><span class="roll_span">+</span>
                    <span id="roll1-2" class="roll_span">0</span><span class="roll_span">+</span>
                    <span id="roll1-3" class="roll_span">0</span><span class="roll_span">+</span>
                    <span id="roll1-4" class="roll_span">0</span><span id="last_plus1" class="roll_span">+</span>
                    <span id="roll1-5" class="roll_span">0</span><span class="roll_span">=</span>
                    <span id="roll_total1" class="roll_span">0 (-)</span>
                </div>
            </div>
            <!--<div id="roll_total1" class="roll_total">0 (-)</div>-->
            <div class="ability_select" style="display:inline-block;">
                <select onchange="adjustEndurance(1, this)" id="select1">
                    <option value="">Strength</option> <!--TODO: REMOVE-->
                    <option value="strength">Strength</option>
                    <option value="quickness">Quickness</option>
                    <option value="intelligence">Intelligence</option>
                    <option value="leadership">Leadership</option>
                    <option value="endurance">Endurance</option>
                </select>
            </div>
        </div>
        <div id="row2_ability" class="ability_row">
            <button class="game_button ability_button" onclick="rollAttribute(2, this)" style="display:inline-block;">Second Roll</button>
            <div class="roll_display" style="display:inline-flex;">
                <div class="roll_numbers">
                    <span id="roll2-1" class="roll_span">0</span><span class="roll_span">+</span>
                    <span id="roll2-2" class="roll_span">0</span><span class="roll_span">+</span>
                    <span id="roll2-3" class="roll_span">0</span><span class="roll_span">+</span>
                    <span id="roll2-4" class="roll_span">0</span><span id="last_plus2" class="roll_span">+</span>
                    <span id="roll2-5" class="roll_span">0</span><span class="roll_span">=</span>
                    <span id="roll_total2" class="roll_span">0 (-)</span>
                </div>
            </div>
            <div class="ability_select">
                <select onchange="adjustEndurance(2, this)" id="select2">
                    <option value="">Quickness</option> <!--TODO: REMOVE-->
                    <option value="strength">Strength</option>
                    <option value="quickness">Quickness</option>
                    <option value="intelligence">Intelligence</option>
                    <option value="leadership">Leadership</option>
                    <option value="endurance">Endurance</option>
                </select>
            </div>
        </div>
        <div id="row3_ability" class="ability_row">
            <button class="game_button ability_button" onclick="rollAttribute(3, this)" style="display:inline-block;">Third Roll</button>
            <div class="roll_display" style="display:inline-flex;">
                <div class="roll_numbers">
                    <span id="roll3-1" class="roll_span">0</span><span class="roll_span">+</span>
                    <span id="roll3-2" class="roll_span">0</span><span class="roll_span">+</span>
                    <span id="roll3-3" class="roll_span">0</span><span class="roll_span">+</span>
                    <span id="roll3-4" class="roll_span">0</span><span id="last_plus3" class="roll_span">+</span>
                    <span id="roll3-5" class="roll_span">0</span><span class="roll_span">=</span>
                    <span id="roll_total3" class="roll_span">0 (-)</span>
                </div>
            </div>
            <div class="ability_select">
                <select onchange="adjustEndurance(3, this)" id="select3">
                    <option value="">Intelligence</option> <!--TODO: REMOVE-->
                    <option value="strength">Strength</option>
                    <option value="quickness">Quickness</option>
                    <option value="intelligence">Intelligence</option>
                    <option value="leadership">Leadership</option>
                    <option value="endurance">Endurance</option>
                </select>
            </div>
        </div>
        <div id="row4_ability" class="ability_row">
            <button class="game_button ability_button" onclick="rollAttribute(4, this)" style="display:inline-block;">Fourth Roll</button>
            <div class="roll_display" style="display:inline-flex;">
                <div class="roll_numbers">
                    <span id="roll4-1" class="roll_span">0</span><span class="roll_span">+</span>
                    <span id="roll4-2" class="roll_span">0</span><span class="roll_span">+</span>
                    <span id="roll4-3" class="roll_span">0</span><span class="roll_span">+</span>
                    <span id="roll4-4" class="roll_span">0</span><span id="last_plus4" class="roll_span">+</span>
                    <span id="roll4-5" class="roll_span">0</span><span class="roll_span">=</span>
                    <span id="roll_total4" class="roll_span">0 (-)</span>
                </div>
            </div>
            <div class="ability_select">
                <select onchange="adjustEndurance(4, this)" id="select4">
                    <option value="">Leadership</option> <!--TODO: REMOVE-->
                    <option value="strength">Strength</option>
                    <option value="quickness">Quickness</option>
                    <option value="intelligence">Intelligence</option>
                    <option value="leadership">Leadership</option>
                    <option value="endurance">Endurance</option>
                </select>
            </div>
        </div>
        <div id="row5_ability" class="ability_row">
            <button class="game_button ability_button" onclick="rollAttribute(5, this)" style="display:inline-block;">Fifth Roll</button>
            <div class="roll_display" style="display:inline-flex;">
                <div class="roll_numbers">
                    <span id="roll5-1" class="roll_span">0</span><span class="roll_span">+</span>
                    <span id="roll5-2" class="roll_span">0</span><span class="roll_span">+</span>
                    <span id="roll5-3" class="roll_span">0</span><span class="roll_span">+</span>
                    <span id="roll5-4" class="roll_span">0</span><span id="last_plus5" class="roll_span">+</span>
                    <span id="roll5-5" class="roll_span">0</span><span class="roll_span">=</span>
                    <span id="roll_total5" class="roll_span">0 (-)</span>
                </div>
            </div>
            <div class="ability_select">
                <select onchange="adjustEndurance(5, this)" id="select5">
                    <option value="">Endurance</option> <!--TODO: REMOVE-->
                    <option value="strength">Strength</option>
                    <option value="quickness">Quickness</option>
                    <option value="intelligence">Intelligence</option>
                    <option value="leadership">Leadership</option>
                    <option value="endurance">Endurance</option>
                </select>
            </div>
        </div>
        <div id="save" style="display: flex;">
            <button class="game_button" onclick="saveAbilities()"
                    style="height: 5vh;font-size: 10pt;margin-top: -7vh;">Save</button>
            <p id="validate_error" class="error_message" style="display: none;">
                Assign an ability to each roll</p>
        </div>
    </div>
    <div id="class_body" style="display: none;">
        <div>
            <p style="font-size:24pt; margin-bottom:0;">Select a Class:</p>
            <p style="font-size: 10pt;">(Choosing a class that does not fit your ability layout will cause your scores to be reordered)</p>
            <div>
                <select onchange="loadClassDescription(this)" id="class_select" style="width:20vw;padding-left:1.4vw;"></select>
                <button id="save_class" class="game_button hidden" style="
                                    width: 5vw;
                                    height: 4vh;
                                    font-size: 10pt;
                                    margin-left:1vw;
                " onclick="saveClass()">Save</button>
            </div>
            <span id="class_validate_error" class="hidden error_message" style="color:rgb(255, 187, 22); font-weight:bold; padding-top:1vh;"></span>
            <p id="class_description"></p>
            <p id="traits_header" style="font-size:16pt;margin-bottom:-1vh;margin-top:-1vh;" class="hidden">Class Traits:</p>
            <ul id="class_traits" style="text-align: left;"></ul>
            <p id="restrictions_header" style="font-size:16pt;margin-bottom:-1vh;margin-top:-1vh;" class="hidden">Class Restrictions:</p>
            <ul id="class_restrictions" style="text-align: left;"></ul>
        </div>
    </div>
    <div id="race_body" style="display: none;">
        <div>
            <p style="font-size:24pt; margin-bottom:0;">Select a Race:</p>
            <p style="font-size: 10pt;">(Ability scores affected by your chosen race will be calculated at the end of character creation)</p>
            <div>
                <select onchange="loadRaceDescription(this)" id="race_select" style="width:20vw;padding-left:1.4vw;"></select>
                <button id="save_race" class="game_button hidden" style="
                                        width: 5vw;
                                        height: 4vh;
                                        font-size: 10pt;
                                        margin-left:1vw;
                    " onclick="saveRace()">Save</button>
            </div>
            <span id="race_validate_error" class="hidden error_message" style="color:rgb(255, 187, 22); font-weight:bold; padding-top:1vh;"></span>
            <p id="race_description"></p>
            <p id="racial_traits_header" style="font-size:16pt;margin-bottom:-1vh;margin-top:-1vh;" class="hidden">Racial Traits:</p>
            <ul id="racial_traits" style="text-align: left;width:25vw;padding-left:16vw;"></ul>
            <p id="racial_powers_header" style="font-size:16pt;margin-bottom:-1vh;margin-top:-1vh;" class="hidden">Racial Power:</p>
            <div id="racial_power_container" data-tooltip-content="#tooltip_content" onmouseover="update_racial_tooltip()"
                            style="display: inline-flex;margin-top: 3vh;width: 17vw;">
                <p id="racial_powers" style="text-align: center;width:10vw;"></p>
            </div>
        </div>
    </div>
    <div id="powers_body" style="display: none;">
        <div id="powers_display" style="position:absolute;">
            <h3 id="select_class_first">Save your class selection to view available powers</h3>
            <p id="power_title_container" style="font-size:24pt; margin-bottom:0; text-align:center;" class="hidden"><span id="power_title"></span> Powers:</p>
            <p style="font-size: 10pt; text-align: center;" id="points_remaining"></p>
            <p id="power_warning" style="font-size:10pt;text-align:center;color:yellow;margin-bottom:-3vh;" class="hidden">
                *Not enough power points remaining. Deselect a power by clicking it again*
            </p>
            <table id="power_table"></table>
        </div>
    </div>
    <div id="name_body" style="display: none;">
        <div style="position:absolute;left:25vw;top:30vh;font-size:16pt;">
            <form id="character_info" title="Character Information">
                Character Name: <input class="char_input" name="character_name" onkeyup="update_character_name(this)"><br>
                Player Screen Name: <input class="char_input" name="player_name" onkeyup="update_player_name(this)"><br>
                Homeland: <input class="char_input" name="homeland"><br>
                <input type="radio" name="gender" value="male">Male
                <input type="radio" name="gender" value="female">Female<br>
            </form>
        </div>
    </div>
    <div id="start_body" style="display: none;">
        <div style="width:75%;margin:4vh auto;">
            <span class="start_text">Character Name: <span id="start_char_name"></span></span><br>
            <span class="start_text">Player: <span id="start_player"></span></span><br><br>
            <span class="start_text">Strength: <span id="start_s"></span></span><br>
            <span class="start_text">Quickness: <span id="start_q"></span></span><br>
            <span class="start_text">Intelligence: <span id="start_i"></span></span><br>
            <span class="start_text">Leadership: <span id="start_l"></span></span><br>
            <span class="start_text">Endurance: <span id="start_e"></span></span><br><br>
            <span class="start_text">Race: <u><span id="start_race"></span></u><span id="start_gender"></span></span><br>
            <span class="start_text">Racial Power: </span><br>
            <div id="start_racial_powers_div"></div><br>
            <span class="start_text">Class: <u><span id="start_class"></span></u></span><br>
            <span class="start_text">Class Powers: </span><br>
            <div id="start_powers_div"></div>
            <!--TODO:Add inventory summary and followers/pets-->
        </div>
    </div>
    <div id="ability_scores" class="ability_scores_box" style="display: none;">
        <span id="char_name" style="font-size: 14pt;"><u>New Character</u></span><br>
        <span id="player_name"><u>Player 1</u></span><br><br>
        <div><span>Strength: </span><span id="ability_s"></span></div>
        <div><span>Quickness: </span><span id="ability_q"></span></div>
        <div><span>Intelligence: </span><span id="ability_i"></span></div>
        <div><span>Leadership: </span><span id="ability_l"></span></div>
        <div><span>Endurance: </span><span id="ability_e"></span></div><br>
        <div><span>Race: </span><span id="char_race" class="hidden"></span></div>
        <div><span>Class: </span><span id="char_class" class="hidden"></span></div><br>
        <div id="char_powers_container" style="max-width: 18vw;"><span><u>Powers: </u></span></div>
    </div>

</div>
<div class="tooltip_templates">
    <div id="tooltip_content">
        <div id="power_container" style="width: 30vw;">
            <img src="" id="power_icon">
            <span id="tooltip_power_name" style="font-size:16pt;vertical-align:top;padding-left: 1vw;"></span>
            <p id="tooltip_power_description" style="margin-top:0;font-size:10pt;"></p>
        </div>
    </div>
</div>
<div id="race_modal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <span onclick="hide_race_modal()" class="close">&times;</span>
            <h2 id="race_modal_header"></h2>
        </div>
        <div id="race_modal_body" class="modal-body">
        </div>
        <div class="modal-footer">
            <div>
                <button id="cancel_modal_button" class="game_button" onclick="hide_race_modal()">Cancel</button>
                <button id="accept_modal_button" class="game_button">Save</button>
            </div>
            <div id="race_error" class="hidden" style="padding-bottom: 1vh;">
                <span>*Bonuses and Penalties cannot be applied to the same ability*</span>
            </div>
        </div>
    </div>
</div>
<div id="race_modal_templates" style="display:none;">
    <div id="dwarf_modal_content">
        <div class="racial_bonuses">
            <table class="race_table">
                <tr>
                    <th class="race_table_header">Bonuses: +2 to Strength and Endurance</th>
                    <th class="race_table_header">Penalties: -4 to Intelligence</th>
                </tr>
                <tr>
                    <td class="race_cell center_cell">Strength: <span id="dwarf_s"></span></td>
                    <td class="race_cell center_cell">Intelligence: <span id="dwarf_i"></span></td>
                </tr>
                <tr>
                    <td class="race_cell center_cell">Endurance: <span id="dwarf_e"></span></td>
                </tr>
            </table>
        </div>
    </div>
    <div id="half_elf_modal_content">
        <div class="racial_bonuses">
            <table class="race_table" style="border-bottom:1pt solid black;">
                <tr>
                    <th class="race_table_header">Bonuses: +3 to one ability</th>
                    <th class="race_table_header">Penalties: -3 to one ability</th>
                </tr>
                <tr>
                    <td class="race_cell" style="text-align: center;">
                        <select id="half_elf_bonus_select" onchange="applyHalfElfBonus(this)">
                            <option></option>
                            <option>Strength</option>
                            <option>Quickness</option>
                            <option>Intelligence</option>
                            <option>Leadership</option>
                        </select>
                    </td>
                    <td class="race_cell" style="text-align: center;">
                        <select id="half_elf_penalty_select" onchange="applyHalfElfPenalty(this)">
                            <option></option>
                            <option>Strength</option>
                            <option>Quickness</option>
                            <option>Intelligence</option>
                            <option>Leadership</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: center;"><span id="half_elf_bonus"></span></td>
                    <td style="text-align: center;"><span id="half_elf_penalty"></span></td>
                </tr>
            </table>
        </div>
    </div>
    <div id="half_orc_modal_content">
        <div class="racial_bonuses">
            <table class="race_table">
                <tr>
                    <th class="race_table_header">Bonuses: +4 to one ability</th>
                    <th class="race_table_header">Penalties: -2 to all other abilities</th>
                </tr>
                <tr>
                    <td class="race_cell center_cell">
                        <select id="half_orc_bonus_select" onchange="applyHalfOrcBonus(this)">
                            <option></option>
                            <option>Strength</option>
                            <option>Quickness</option>
                            <option>Intelligence</option>
                            <option>Leadership</option>
                        </select>
                    </td>
                    <td>
                        <div class="center_cell">
                            <span id="penalty_1"></span>
                        </div>
                        <div class="center_cell">
                            <span id="penalty_2"></span>
                        </div>
                        <div class="center_cell">
                            <span id="penalty_3"></span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="center_cell"><span id="half_orc_bonus"></span></td>
                </tr>
            </table>
        </div>
    </div>
    <div id="high_elf_modal_content">
        <div class="racial_bonuses">
            <table class="race_table">
                <tr>
                    <th class="race_table_header">Bonuses: +3 to Quickness or Leadership</th>
                    <th class="race_table_header">Penalties: -2 to Strength</th>
                </tr>
                <tr>
                    <td class="race_cell center_cell">
                        <select id="high_elf_bonus_select" onchange="applyHighElfBonus(this)">
                            <option></option>
                            <option>Quickness</option>
                            <option>Leadership</option>
                        </select>
                    </td>
                    <td class="race_cell center_cell">Strength: <span id="high_elf_s"></span></td>
                </tr>
                <tr>
                    <td style="text-align: center;"><span id="high_elf_bonus"></span></td>
                </tr>
            </table>
        </div>
    </div>
    <div id="hobbit_modal_content">
        <div class="racial_bonuses">
            <table class="race_table">
                <tr>
                    <th class="race_table_header">Bonuses: +2 to Quickness and Intelligence</th>
                    <th class="race_table_header">Penalties: -4 to Strength</th>
                </tr>
                <tr>
                    <td class="race_cell center_cell">Quickness: <span id="hobbit_q"></span></td>
                    <td class="race_cell center_cell">Strength: <span id="hobbit_s"></span></td>
                </tr>
                <tr>
                    <td class="race_cell center_cell">Intelligence: <span id="hobbit_i"></span></td>
                </tr>
            </table>
        </div>
    </div>
    <div id="human_modal_content">
        <div class="racial_bonuses">
            <table class="race_table">
                <tr>
                    <th class="race_table_header">Bonuses: +2 to one ability </th>
                    <th class="race_table_header">Penalties: -2 to another ability</th>
                </tr>
                <tr>
                    <td class="race_cell" style="text-align: center;">
                        <select id="human_bonus_select" onchange="applyHumanBonus(this)">
                            <option></option>
                            <option>Strength</option>
                            <option>Quickness</option>
                            <option>Intelligence</option>
                            <option>Leadership</option>
                            <option>No ability changes</option>
                        </select>
                    </td>
                    <td class="race_cell" style="text-align: center;">
                        <select id="human_penalty_select" onchange="applyHumanPenalty(this)">
                            <option></option>
                            <option>Strength</option>
                            <option>Quickness</option>
                            <option>Intelligence</option>
                            <option>Leadership</option>
                            <option>No ability changes</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td class="race_cell center_cell"><span id="human_bonus"></span></td>
                    <td class="race_cell center_cell"><span id="human_penalty"></span></td>
                </tr>
            </table>
            <table class="race_table">
                <tr>
                    <th>OR select 'No ability changes'</th>
                </tr>
            </table>
        </div>
    </div>
    <div id="orc_modal_content">
        <div class="racial_bonuses">
            <table class="race_table">
                <tr>
                    <th class="race_table_header">Bonuses: +4 to Strength</th>
                    <th class="race_table_header">Penalties: -6 to Intelligence or Leadership</th>
                </tr>
                <tr>
                    <td class="race_cell center_cell">Strength: <span id="orc_s"></span></td>
                    <td class="race_cell" style="text-align: center;">
                        <select id="orc_penalty_select" onchange="applyOrcPenalty(this)">
                            <option></option>
                            <option>Intelligence</option>
                            <option>Leadership</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td class="race_cell center_cell"><span id="orc_penalty"></span></td>
                </tr>
            </table>
        </div>
    </div>
    <div id="wood_elf_modal_content">
        <div class="racial_bonuses">
            <table class="race_table">
                <tr>
                    <th class="race_table_header">Bonuses: +3 to Quickness or Intelligence</th>
                    <th class="race_table_header">Penalties: -2 to Strength</th>
                </tr>
                <tr>
                    <td class="race_cell" style="text-align: center;">
                        <select id="wood_elf_bonus_select" onchange="applyWoodElfBonus(this)">
                            <option></option>
                            <option>Quickness</option>
                            <option>Intelligence</option>
                        </select>
                    </td>
                    <td class="race_cell center_cell">Strength: <span id="wood_elf_s"></span></td>
                </tr>
                <tr>
                    <td style="text-align: center;"><span id="wood_elf_bonus"></span></td>
                </tr>
            </table>
        </div>
    </div>
</div>
<div id="class_modal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <span onclick="hide_class_modal()" class="close">&times;</span>
            <h2 id="class_modal_header"></h2>
        </div>
        <div id="class_modal_body" class="modal-body">
        </div>
        <div class="modal-footer">
            <div>
                <button id="" class="modal_button game_button" onclick="hide_class_modal()">Cancel</button>
                <button id="" class="modal_button game_button">Save</button>
            </div>
            <div id="class_error" class="hidden" style="padding-bottom: 1vh;">
                <span>*Bonuses and Penalties cannot be applied to the same ability*</span>
            </div>
        </div>
    </div>
</div>
<div id="class_modal_templates" style="display: none;">
    <div id="hunter_modal_content"></div>
    <div id="weapon_master_modal_content"></div>
    <div id="outrider_modal_content"></div>
    <div id="ranger_modal_content"></div>
    <div id="conjurer_modal_content"></div>
    <div id="skinchanger_modal_content"></div>
    <div id="sorcerer_modal_content"></div>
</div>
</body>
</html>