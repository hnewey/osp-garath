<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Osp-Garath</title>

    <link rel="stylesheet" href="css/ospgarath_style.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/rpg-awesome.css">
    <link rel="stylesheet" type="text/css" href="tooltipster/dist/css/tooltipster.bundle.min.css" />
    <link rel="stylesheet" href="tooltipster/dist/css/plugins/tooltipster/sideTip/themes/tooltipster-sideTip-borderless.min.css"/>

    <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
    <script type="text/javascript" src="tooltipster/dist/js/tooltipster.bundle.min.js"></script>
    <script type="text/javascript" src="js/tooltipster-discovery.min.js"></script>
    <!--<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>-->

</head>
<style>
    body {
        background: url("img/game_background2.jpg"), no-repeat;
        -webkit-background-size: 100%;
        background-size: 100%;
        margin: 0;
        height: 100%;
        overflow: hidden;
    }

    #board_container {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 101vh;
        height: 100vh;
        margin-top: -50vh;
        margin-left: -50vh;
        /*-webkit-box-shadow: 0px 0px 50px black;*/
        /*-moz-box-shadow: 0px 0px 50px black ;*/
        /*box-shadow: 0px 0px 50px black ;*/
    }

    #board_border {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 101vh;
        height: 100vh;
        margin-top: -50vh;
        margin-left: -50vh;
    }

    #current_board {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 92vh;
        height: 92vh;
        margin-top: -45.75vh;
        margin-left: -45.75vh;
        box-shadow: 0 0 50px white;
    }

    .attribute_bar {
        position: absolute;
        width: 30vh;
        height: 3vh;
    }

    #endurance {
        position: absolute;
        left: 2.45vh;
        top: 15vh;
        width: 29.3vh;
        height: 2.3vh;
    }

    #experience {
        position: absolute;
        left: 2.45vh;
        top: 18.3vh;
        width: 29.3vh;
        height: 2.4vh;
    }

    .ability_score {
        padding-left: .5vh;
    }

    #end_overlay {
        position: absolute;
        font-size: 1.8vh;
        left: 13vh;
        top: 15.1vh;
    }

    #exp_overlay {
        position: absolute;
        font-size: 1.8vh;
        left: 14vh;
        top: 18.5vh;
    }

    #character_icon {
        position: absolute;
        /*left: 47.2vh;*/
        /*top: 89.6vh;*/
        width: 6.85vh;
        height: 6.5vh;
        box-shadow: 0 2px 15px 3px black;
        z-index: 100;
    }

    #enemy_icon {
        position: absolute;
        left: 47.2vh;
        top: 68.27vh;
        width: 6.85vh;
        height: 6.5vh;
        box-shadow: 0 2px 15px 3px black;
    }

    #actions_status {
        position: absolute;
        left: 5.5vh;
        top: 5vh;
        font-size: 2.2vh;
    }

    #movement_arrows {
        position: absolute;
        left: 78vh;
        top: 85vh;
    }

    .arrows {
        width: 4.5vh;
        height: 4.5vh;
    }

    .tooltip {
        font-family: 'Marcellus SC', serif;
        color: yellow;
        cursor: default;
    }

    .tooltip:hover {
        text-shadow: 0 0 5px yellow;
    }

    .action_list {
        text-align:center;
        color: yellow;
        font-family: 'Marcellus SC', serif;
        cursor: default;
    }

    .action:hover {
        text-shadow: 0 0 5px yellow;
    }

    .hidden {
        display: none;
    }

    #end_turn_button {
        text-align: center;
        background: url("img/button_new2.jpg") no-repeat;
        color: yellow;
        font-family: 'Marcellus SC', serif;
        cursor: default;
        background-size: contain;
        outline: none;
        border: none;
        font-size: 1.8vh;
        width: 14vh;
        height: 6vh;
    }

    #end_turn_button:hover {
        text-shadow: 0 0 5px yellow;
        box-shadow: 0 0 5px yellow;
    }

    #end_turn_button:active {
        background: url("img/button_new_clicked.jpg");
        background-size: contain;
        width: 14vh;
        height: 6vh;
    }

    #end_turn_container {
        position: absolute;
        left: 8vh;
        top: 89.6vh;
    }

    .turn_banner {
        position: absolute;
        margin: auto;
        top: 43.8vh;
        width: 100%;
    }

    .banner_words {
        position: absolute;
        left: 1vh;
        top: 1.7vh;
        font-family: 'Marcellus SC', serif;
        text-shadow: 0 0 40px yellow;
        font-size: 24pt;
    }

    #start_banner_gradient {
        /* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#1e5799+20,2989d8+50,1e5799+80&0+0,0.8+15,1+19,1+81,0.8+85,0+100;Blue+Two+Sided+Transparent */
        background: -moz-linear-gradient(top, rgba(30,87,153,0) 0%, rgba(30,87,153,0.8) 15%, rgba(30,87,153,1) 19%, rgba(30,87,153,1) 20%, rgba(41,137,216,1) 50%, rgba(30,87,153,1) 80%, rgba(30,87,153,1) 81%, rgba(30,87,153,0.8) 85%, rgba(30,87,153,0) 100%); /* FF3.6-15 */
        background: -webkit-linear-gradient(top, rgba(30,87,153,0) 0%,rgba(30,87,153,0.8) 15%,rgba(30,87,153,1) 19%,rgba(30,87,153,1) 20%,rgba(41,137,216,1) 50%,rgba(30,87,153,1) 80%,rgba(30,87,153,1) 81%,rgba(30,87,153,0.8) 85%,rgba(30,87,153,0) 100%); /* Chrome10-25,Safari5.1-6 */
        background: linear-gradient(to bottom, rgba(30,87,153,0) 0%,rgba(30,87,153,0.8) 15%,rgba(30,87,153,1) 19%,rgba(30,87,153,1) 20%,rgba(41,137,216,1) 50%,rgba(30,87,153,1) 80%,rgba(30,87,153,1) 81%,rgba(30,87,153,0.8) 85%,rgba(30,87,153,0) 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#001e5799', endColorstr='#001e5799',GradientType=0 ); /* IE6-9 */
        height: 12vh;
    }

    #start_banner_content {
        position: relative;
        top: 1.7vh;
    }

    .slide_animation {
        left: 0;
        -webkit-animation-duration: 500ms;
        animation-duration: 500ms;
        -webkit-animation-delay: 0s;
        animation-delay: 0s;
        -webkit-animation-fill-mode: both;
        animation-fill-mode: both;
    }

    .slide_right {
        -webkit-animation-name: slideRight;
        animation-name: slideRight;
    }

    .fade_in {
        opacity: 0;
        -webkit-animation-duration: 200ms;
        animation-duration: 200ms;
        -webkit-animation-delay: 0s;
        animation-delay: 0s;
        -webkit-animation-fill-mode: both;
        animation-fill-mode: both;
        -webkit-animation-name: fadeIn;
        animation-name: fadeIn;
    }

    .fade_out {
        opacity: 100;
        -webkit-animation-duration: 2s;
        animation-duration: 2s;
        -webkit-animation-delay: 2s;
        animation-delay: 2s;
        -webkit-animation-fill-mode: both;
        animation-fill-mode: both;
        -webkit-animation-name: fadeOut;
        animation-name: fadeOut;
    }

    .fade_in_out {
        opacity: 0;
        -webkit-animation-duration: 2s;
        animation-duration: 2s;
        -webkit-animation-delay: 0s;
        animation-delay: 0s;
        -webkit-animation-fill-mode: both;
        animation-fill-mode: both;
        -webkit-animation-name: fadeInOut;
        animation-name: fadeInOut;
    }

    @-webkit-keyframes slideRight {
        0% {left: 0;}
        100% {left: 85vh;}
    }

    @keyframes slideRight {
        0% {left: 0;}
        100% {left: 85vh;}
    }

    @-webkit-keyframes fadeIn {
        0% {opacity: 0;}
        100% {opacity: 1;}
    }

    @keyframes fadeIn {
        0% {opacity: 0;}
        100% {opacity: 1;}
    }

    @-webkit-keyframes fadeOut {
        100% {opacity: 1;}
        0% {opacity: 0;}
    }

    @keyframes fadeOut {
        100% {opacity: 1;}
        0% {opacity: 0;}
    }

   @-webkit-keyframes fadeInOut {
        0% {opacity: 0;}
        5% {opacity: 100;}
        85% {opacity: 100;}
        100% {opacity: 0;}
    }

    @keyframes fadeInOut {
        0% {opacity: 0;}
        5% {opacity: 100;}
        85% {opacity: 100;}
        100% {opacity: 0;}
    }

</style>
<script>
    var VERTICAL_INCREASE = 7.11;
    var HORIZONTAL_INCREASE = 7.15;
    var CHAR_X = 0;
    var CHAR_Y = -6;

    var GAME_STATE;

    var ACTION_MENU_VISIBLE = false;
    var CLICK_TO_MOVE = false;

    var ENEMIES = [];
    var OFF_LIMIT_SQUARES = [];

    var BOARD = [];
    var CHAR_POSSIBLE_MOVES = [];
    var CHAR_BLOCKED_MOVES = [];
    var CHARACTER;

    var MOVE_USED = false;
    var QUICK_USED = false;
    var STD_USED = false;

    var QUICK_ACTIONS;
    var STD_ACTIONS;

    var QUICK_ACTIONS_VALID = false;
    var STD_ACTIONS_VALID = false;

    var POLLING_INTERVAL;
    var TIMEOUT = 30000;
    var TIMEOUT_ID;
    var POLLING_ACTIVE = false;

    var NESTED_TOOLTIPS = [];

    function startTimer() {
        TIMEOUT_ID = window.setTimeout(setInactive, TIMEOUT);
        startPolling();
    }

    function setInactive() {
        POLLING_ACTIVE = false;
        window.clearTimeout(TIMEOUT);
        endPolling();
    }

    function resetTimer() {
        window.clearTimeout(TIMEOUT);
        startTimer();
    }

    function setupTimers() {
        document.addEventListener("mousemove", resetTimer, false);
        document.addEventListener("mousedown", resetTimer, false);
        document.addEventListener("keypress", resetTimer, false);
        document.addEventListener("touchmove", resetTimer, false);

        startTimer();
    }

    function activateActionsOptionsTooltipster() {
        var $character = $('#character_icon');
        if (ACTION_MENU_VISIBLE) {
            clearActiveTooltipsters();
            return;
        }

        //Quick-Left
        if (!QUICK_USED) {
            $character.tooltipster({
                theme: 'tooltipster-borderless',
                animation: 'grow',
                trigger: 'click',
                side: 'left',
                content: $('<span class="tooltip">Quick Action</span>'),
                multiple: true,
                interactive: true,
                functionReady: function (instance, helper) {
                    // the nested tooltip must be initialized once the first tooltip is open, that's why we do this inside functionReady()
                    instance.content().tooltipster({
                        theme: 'tooltipster-borderless',
                        content: QUICK_ACTIONS,
                        distance: 0,
                        side: 'bottom',
                        interactive: true,
                        trigger: 'click',
                        functionReady: function (instance, helper) {
                            NESTED_TOOLTIPS.push(instance);
                        }
                    });
                },
                functionAfter: function (instance, helper) {
                    this.destroy();
                    ACTION_MENU_VISIBLE = false; //only needed once
                }
            });
        }

        //Move-Top
        if (!MOVE_USED) {
            $character.tooltipster({
                theme: 'tooltipster-borderless',
                animation: 'grow',
                trigger: 'click',
                side: 'top',
                content: $('<span class="tooltip" onclick="showMovementTree()">Move</span>'),
                multiple: true,
                interactive: true,
                functionAfter: function (instance, helper) {
                    this.destroy();
                }
            });
        }

        //Standard-Right
        if (!STD_USED) {
            $character.tooltipster({
                theme: 'tooltipster-borderless',
                animation: 'grow',
                trigger: 'click',
                side: 'right',
                content: $('<span class="tooltip">Standard Action</span>'),
                multiple: true,
                interactive: true,
                functionReady: function (instance, helper) {
                    // the nested tooltip must be initialized once the first tooltip is open, that's why we do this inside functionReady()
                    instance.content().tooltipster({
                        theme: 'tooltipster-borderless',
                        content: STD_ACTIONS,
                        distance: 0,
                        side: 'bottom',
                        interactive: true,
                        trigger: 'click',
                        functionReady: function (instance, helper) {
                            NESTED_TOOLTIPS.push(instance);
                        }
                    });
                },
                functionAfter: function (instance, helper) {
                    this.destroy();
                }
            });
        }

        var instances = $.tooltipster.instances($character);
        for (var i = 0; i < instances.length; i++) {
            instances[i].open();
        }
        ACTION_MENU_VISIBLE = true;
    }

    //called whenever the character moves or something on the board changes
    function invalidateActionLists() {
        QUICK_ACTIONS_VALID = false;
        STD_ACTIONS_VALID = false;
    }

    function clearActiveTooltipsters() {
        var $character = $('#character_icon');
        var current_instances = $.tooltipster.instances($character);

        for (var i = 0; i < NESTED_TOOLTIPS.length; i++) {
            NESTED_TOOLTIPS[i].close();
        }
        for (var j = 0; j < current_instances.length; j++) {
            // clearNestedTooltipsters($.tooltipster.instances(current_instances[j]));
            current_instances[j].close();
        }
        NESTED_TOOLTIPS = [];
        ACTION_MENU_VISIBLE = false;
    }

    function clearNestedTooltipsters(instances) {
        if (instances === null || instances.length === 0) {
            return;
        }
        for (var i = 0; i < instances.length; i++) {
            clearNestedTooltipsters($.tooltipster.instances(instances[i]));
            instances[i].close();
        }
    }

    // function getStandardActions() {
    //     post("/game/standardActions", CHARACTER, function (data, status) {
    //         STD_ACTIONS = createActionList(data, "standard");
    //     });
    // }

    // function getQuickActions() {
    //     post("/game/quickActions", CHARACTER, function(data, status) {
    //         QUICK_ACTIONS = createActionList(data, "Quick");
    //     });
    // }

    function createActionList(data, type) {
        var actionContainer = document.createElement("div");
        actionContainer.id = "quick_action_list";
        actionContainer.classList.add("action_list");
        for (var i = 0; i < data.length; i++) {
            var action = document.createElement("p");
            action.innerText = data[i];
            action.classList.add("action");
            action.setAttribute("onclick", "handleAction('"+data[i].replace(" ", "")+"', '"+type+"')");
            actionContainer.appendChild(action);
        }
        return actionContainer;
    }

    function handleAction(action, type) {
        clearActiveTooltipsters();
        actionUsed(type);
    }

    function equip_item() {
    }



    function getViewPortPositionLeft(x) {
        return 47.2 + (HORIZONTAL_INCREASE * x);
    }

    function getViewPortPositionTop(y) {
        return 46.94 - (VERTICAL_INCREASE * y);
    }

    //use a character's movement to move to a space
    function moveCharacter(x, y) {
        if (!checkObstacles(x, y)) {
            return false;
        }
        var char_icon = document.getElementById("character_icon");
        char_icon.style.left = (parseFloat(getViewPortPositionLeft(x))) + "vh";
        char_icon.style.top = (parseFloat(getViewPortPositionTop(y))) + "vh";
        CHAR_X = x;
        CHAR_Y = y;

        actionUsed("movement");
        invalidateActionLists();
        return true;
    }

    //directly place the character's icon on a space without using their movement
    function placeCharacter(x, y) {
        if (!checkObstacles(x, y)) {
            return false;
        }
        var char_icon = document.getElementById("character_icon");
        char_icon.style.left = (parseFloat(getViewPortPositionLeft(x))) + "vh";
        char_icon.style.top = (parseFloat(getViewPortPositionTop(y))) + "vh";
        CHAR_X = x;
        CHAR_Y = y;
    }

    function actionUsed(type) {
        type = type.toLowerCase();
        switch(type) {
            case "movement":
                movementUsed();
                break;
            case "quick":
                quickUsed();
                break;
            case "standard":
                standardUsed();
        }
        document.getElementById(type).style.color = "gray";
        pollData();
    }

    function movementUsed() {
        //update character position
        CHARACTER.position.x = CHAR_X;
        CHARACTER.position.y = CHAR_Y;

        MOVE_USED = true;
        var position = {x: CHAR_X, y: CHAR_Y};
        post("game/move", position, function(data, status) {
            activateActionsOptionsTooltipster();
        });
    }

    function quickUsed() {
        QUICK_USED = true;
    }

    function standardUsed() {
        STD_USED = true;
    }

    //create box overlay images and get character movement tree
    $(document).ready(function() {
        startGame();
    });

    function startGame() {
        createBoard();
        getState();

        // queryCharacter();
        // queryPossibleMoves(false);
        // queryBlockedMoves(false);
        // startPolling();
        // setupTimers();
    }

    function startPolling() {
        // if (POLLING_ACTIVE) {
        //     return;
        // }
        // POLLING_INTERVAL = setInterval(function () {
        //     pollData();
        // }, 2000);
        // POLLING_ACTIVE = true;
    }

    function endPolling() {
        // clearInterval(POLLING_INTERVAL);
    }

    function pollData() {
        //update and read game state
        // getState();

        //get possible quick actions from server if necessary
        // if (!QUICK_ACTIONS_VALID) {
        //     getQuickActions();
        //     QUICK_ACTIONS_VALID = true;
        // }
        //
        // //get possible standard actions from server if necessary
        // if (!STD_ACTIONS_VALID) {
        //     getStandardActions();
        //     STD_ACTIONS_VALID = true;
        // }
    }

    function getState() {
        // endPolling();
        $.get("game/state", function(data, status) {
            GAME_STATE = data;
            readState();
            // startPolling();
        });
    }

    function readState() {
        //TODO: detect changes. Most animations come on changes (enemy defeated, char moved, new negative condition, etc)
        readCharacterState(GAME_STATE.character);
        //TODO: read enemy states, objects, room info, etc
    }

    function readCharacterState(state) {
        CHARACTER = state;
        //TODO: add animation moving character from previous position to new position
        placeCharacter(state.position.x, state.position.y);

        QUICK_ACTIONS = createActionList(state.quickActions, "Quick");
        STD_ACTIONS = createActionList(state.standardActions, "Standard");

        CHAR_POSSIBLE_MOVES = state.possibleMovements;
        CHAR_BLOCKED_MOVES = state.blockedMovements;

        setAllCharacterData(state); //TODO: optimize so it's only read once

    }

    function setAllCharacterData(state) {
        setCharacterInfo(state);
        setCharacterAttributes(state);
        setCharacterHealthbar(state);
        setCharacterExperience(state);
    }

    function setCharacterInfo(state) {
        document.getElementById("race_class").innerText = state.characterRace + " - " + state.characterClass;
        document.getElementById("char_name").innerText = state.name;
        document.getElementById("player_name").innerText = state.playerName;

        //TODO: show positive/negative conditions on character
    }

    function setCharacterAttributes(state) {
        var s = state.strength.value;
        var q = state.quickness.value;
        var i = state.intelligence.value;
        var l = state.leadership.value;

        var s_mod = state.strength.rollModifier;
        var q_mod = state.quickness.rollModifier;
        var i_mod = state.intelligence.rollModifier;
        var l_mod = state.leadership.rollModifier;

        document.getElementById("ability_s").innerText = s + " (" + (s_mod > 0 ? "+":"-") + s_mod + ")";
        document.getElementById("ability_q").innerText = q + " (" + (q_mod > 0 ? "+":"-") + q_mod + ")";
        document.getElementById("ability_i").innerText = i + " (" + (i_mod > 0 ? "+":"-") + i_mod + ")";
        document.getElementById("ability_l").innerText = l + " (" + (l_mod > 0 ? "+":"-") + l_mod + ")";
    }

    function setCharacterHealthbar(state) {
        fillHealthBar(state.endurance, state.damageTaken);
    }

    function setCharacterExperience(state) {
        //TODO: fillExpBar(state.lvl, state.experience);
    }

    function fillHealthBar(end, damage) {

    }

    function queryCharacter() {
        $.get("game/character", function (data, status) {
            CHARACTER = data;
            pollData();
        });
    }

    function createBoard() {
        var container = document.getElementById("box_overlays_container");

        $.get("game/board/spaces", function (data, status) {
            BOARD = data;
            for (var i = 0; i < data.length; i++) {
                var x, y, space;
                space = data[i];
                x = space.x;
                y = space.y;

                var div = document.createElement("div");
                div.id = x + "," + y;
                div.style.position = "absolute";
                div.style.left = parseFloat(getViewPortPositionLeft(x)) + "vh";
                div.style.top = parseFloat(getViewPortPositionTop(y)) + "vh";
                div.classList.add("hidden");
                var img = document.createElement("img");
                setSquareColor(space.spaceInfo, img);
                img.id = "img" + x + "," + y;
                img.style = "width: 7.2vh; height: auto; opacity: .7;";
                img.setAttribute("onclick", "clickToMove(" + x + ", " + y + ")");
                div.appendChild(img);
                container.appendChild(div);
            }
        });
    }

    function setSquareColor(spaceInfo, img) {
        switch (spaceInfo) {
            case "FREE":
                img.src = "img/blue_square.jpg";
                break;
            case "OCCUPIED":
                img.src = "img/red_square.jpg";
                break;
            case "OBSTACLE":
                img.src = "img/gray_square.jpg";
                break;
            case "INTERACTION":
                img.src = "img/purple_square.jpg";
                break;
        }
    }

    function showMovementTree() {
        clearActiveTooltipsters();
        if (CHAR_POSSIBLE_MOVES.length === 0) {
            queryPossibleMoves(true);
        }
        else {
            updatePossibleMoves(CHAR_POSSIBLE_MOVES);
        }

        if (CHAR_BLOCKED_MOVES.length === 0) {
            queryBlockedMoves(true);
        }
        else {
            updateBlockedMoves(CHAR_BLOCKED_MOVES);
        }
    }

    function queryPossibleMoves(update) {
        $.get("move/possible", function (data, status) {
            CHAR_POSSIBLE_MOVES = data;
            if (update)
                updatePossibleMoves(data);
        });
    }

    function queryBlockedMoves(update) {
        $.get("move/blocked", function (data, status) {
            CHAR_BLOCKED_MOVES = data;
            if (update)
                updateBlockedMoves(data);
        });
    }

    function updatePossibleMoves(data) {
        for (var i = 0; i < data.length; i++) {
            var x, y, space;
            space = data[i];
            x = space.x;
            y = space.y;

            var box = document.getElementById(x + "," + y);
            box.classList.remove("hidden");
        }
        CLICK_TO_MOVE = true;
    }

    function updateBlockedMoves(data) {
        for (var i = 0; i < data.length; i++) {
            var x, y, space;
            space = data[i];
            x = space.x;
            y = space.y;

            var box = document.getElementById(x + "," + y);
            box.classList.remove("hidden");
        }
    }

    function checkObstacles(x, y) {
        for (i = 0; i < CHAR_BLOCKED_MOVES.length; i++) {
            var square = CHAR_BLOCKED_MOVES[i];
            if (square.x === x && square.y === y) {
                return false;
            }
        }
        return true;
    }

    function hidePossibleMovements() {
        for (var i = -6; i <= 6; i++) {
            for (var j = -6; j <= 6; j++) {
                if (Math.abs(i) + Math.abs(j) > 9) {
                    continue;
                }
                var box = document.getElementById(i + "," + j);
                box.classList.add("hidden");
            }
        }
        CLICK_TO_MOVE = false;
    }

    function clickToMove(x, y) {
        if (!CLICK_TO_MOVE) {
            return;
        }
        if (!moveCharacter(x, y)) {
            return;
        }
        CHAR_X = x;
        CHAR_Y = y;
        hidePossibleMovements();
    }

    function startTurn() {
        //auto-roll for sustaining conditions
        var endTurnBanner = document.getElementById("start_turn_banner");
        var endTurnBannerContent = document.getElementById("start_banner_content");
        endTurnBanner.classList.remove("fade_in_out");
        endTurnBannerContent.classList.remove("slide_animation");
        endTurnBannerContent.classList.remove("slide_right");

    }

    function endTurn() {
        var endTurnBanner = document.getElementById("start_turn_banner");
        var endTurnBannerContent = document.getElementById("start_banner_content");
        endTurnBanner.classList.add("fade_in_out");
        endTurnBannerContent.classList.add("slide_animation");
        endTurnBannerContent.classList.add("slide_right");
        endPolling();
        resetVariables();
        post("game/endTurn", CHARACTER, function(data, status){
            // startPolling();
            //move npc's
            npcTurns();
            startTurn();
        });
        ACTION_MENU_VISIBLE = false;
    }

    function npcTurns() {

    }

    function resetVariables() {
        //reset movement tree to force update from server
        CHAR_POSSIBLE_MOVES = [];
        CHAR_BLOCKED_MOVES = [];

        //reset actions
        MOVE_USED = false;
        QUICK_USED = false;
        STD_USED = false;
        document.getElementById("movement").style.color = "yellow";
        document.getElementById("quick").style.color = "yellow";
        document.getElementById("standard").style.color = "yellow";
    }

    function post(url, body, callback) {
        $.ajax({
            url:url,
            type:"POST",
            data:JSON.stringify(body),
            contentType:"application/json; charset=utf-8",
            dataType:"json",
            success: callback
        });
    }

</script>
<body>
    <div id="board_container">
        <img id="board_border" src="img/game_board.png">
        <img id="current_board" src="img/board1.png">
        <div id="character_icon" onclick="activateActionsOptionsTooltipster()">
            <img src="img/char_icon.jpg" style="width:6.85vh; height:6.85vh;">
        </div>
        <div id="enemy_icon">
            <img src="img/enemy_sample.jpg" style="width:6.85vh; height:6.85vh;">
        </div>
        <div id="actions_status" class="body_font">
            <span><b><u>Available Actions</u></b></span><br>
            <span id="movement">Movement</span><br>
            <span id="quick">Quick</span><br>
            <span id="standard">Standard</span><br>
        </div>
        <div id="end_turn_container">
            <button id="end_turn_button" onclick="endTurn()">End Turn</button>
        </div>
        <div id="box_overlays_container"></div>
    </div>
    <div id="character_info" style="display: inline-flex;">
        <img src="img/char_border2.png" style="width:10vh;height:13vh;">
        <div id="char_name_container" class="header_font" style="margin-left:1vh;">
            <span id="char_name" style="font-size: 2.7vh;">New Character</span><br>
            <span id="player_name" style="font-size: 2.2vh">Player Name</span>
            <div style="height:3vh;"></div>
            <span id="race_class" style="font-size: 2.2vh">Race - Class</span>
        </div>
    </div>
    <div id="abilities_container" class="body_font" style="padding-left: 1vh;display: grid;">
        <img src="img/health_bar.png" class="attribute_bar" style="left:2vh; top:14.6vh;">
        <img src="img/health_bar.png" class="attribute_bar" style="left:2vh; top:17.9vh;">
        <img id="endurance" src="img/health_bar_fill.png">
        <img id="experience" src="img/exp_bar_fill.png">
        <span id="end_overlay">Endurance</span>
        <span id="exp_overlay">Level: <span id="char_level">1</span></span>
        <div style="position: absolute; left:2vh; top:22vh;font-size: 2.2vh">
            <div class="ability_score"><span>S: </span><span id="ability_s">10 (+0)</span></div>
            <div class="ability_score"><span>Q: </span><span id="ability_q">10 (+0)</span></div>
            <div class="ability_score"><span>I: </span><span id="ability_i">10 (+0)</span></div>
            <div class="ability_score"><span>L: </span><span id="ability_l">10 (+0)</span></div>
        </div>
    </div>

    <!--<span id="quick_action" class="tooltip">Quick Action</span>-->
    <div class="tooltip_templates" style="display: none;">
        <div id="action_option_content">
            <div id="action_option">
                <img src="" id="power_icon">
                <span id="tooltip_power_name"></span>
                <p id="tooltip_power_description"></p>
            </div>
        </div>
        <div id="action_list_content">
            <div id="action_list">
                <ul>
                    <li>List option</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="end_turn_banner" class="hidden turn_banner">
        <img src="img/turn_banner.png">
        <span id="end_turn_banner_words" class="banner_words">Enemy Turn</span>
    </div>
    <div id="start_turn_banner" class="turn_banner" style="opacity: 0;">
        <div id="start_banner_gradient">
            <div id="start_banner_content">
                <!--<img src="img/turn_banner.png">-->
                <span id="start_turn_banner_words" class="banner_words"><i><span id="player_name_banner">Lahod</span>'s Turn</i></span>
            </div>
        </div>
    </div>
</body>
</html>